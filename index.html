<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LAVMIS DATA COLLECTOR MODULE | Offline Satellite</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        :root { 
            --sidebar-width: 480px; 
            --primary: #2c3e50; 
            --accent: #3498db; 
            --success: #27ae60; 
            --valuation: #f39c12; 
            --panel-bg: #ffffff; 
            --warning: #e74c3c;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border: #e0e0e0;
            --light-bg: #f8f9fa;
            --firebase: #FFA611;
        }
        
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            width: 100%; 
            font-family: 'Segoe UI', 'Roboto', sans-serif; 
            overflow: hidden; 
            display: flex; 
            background-color: #f5f7fa;
            color: var(--text-primary);
        }
        
        /* LOGIN MODAL STYLES - White theme */
        #loginModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--accent);
            text-align: center;
        }
        
        .login-container h2 {
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .login-input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .login-input-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .login-input-group input {
            width: 100%;
            padding: 14px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: white;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
            box-sizing: border-box;
        }
        
        .login-input-group input:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .login-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent) 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        
        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(52, 152, 219, 0.3);
        }
        
        .login-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .login-error {
            color: var(--warning);
            font-size: 0.85rem;
            margin-top: 5px;
            min-height: 20px;
        }
        
        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent) 0%, #2980b9 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }
        
        .login-logo i {
            font-size: 36px;
            color: white;
        }
        
        .login-footer {
            margin-top: 25px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            padding-top: 15px;
        }
        
        .login-attempts {
            font-size: 0.75rem;
            color: var(--valuation);
            margin-top: 10px;
            font-weight: 500;
        }
        
        .locked-out {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* BACKUP PROGRESS MODAL */
        #backupProgressModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .backup-progress-container {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border-top: 4px solid var(--accent);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .backup-progress-container h3 {
            color: var(--accent);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: var(--light-bg);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .backup-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .backup-stat {
            background: var(--light-bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .backup-stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .backup-stat-value {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .backup-success {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: rgba(39, 174, 96, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--success);
        }
        
        .backup-success i {
            color: var(--success);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        /* HIDE MAIN CONTENT BEFORE LOGIN */
        #mainContent {
            display: none;
            width: 100%;
            height: 100%;
        }
        
        /* SIDEBAR - White Theme */
        #sidebar { 
            width: var(--sidebar-width); 
            background: white; 
            color: var(--text-primary); 
            padding: 20px; 
            overflow-y: auto; 
            z-index: 2000; 
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }
        
        #map { 
            flex-grow: 1; 
            height: 100%; 
            z-index: 1; 
            background: #f0f2f5; 
            cursor: crosshair;
        }
        
        .status-bar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .indicator { 
            padding: 6px 12px; 
            border-radius: 20px; 
            font-size: 0.75rem; 
            font-weight: 600; 
            letter-spacing: 0.5px;
        }
        
        .on { background: #e8f6ef; color: var(--success); border: 1px solid #d5f0e1; }
        .off { background: #fdeaea; color: var(--warning); border: 1px solid #f9d6d6; }
        .warning-ind { background: #fef9e7; color: var(--valuation); border: 1px solid #fcf3cf; }
        .firebase-ind { background: #fff3e0; color: var(--firebase); border: 1px solid #ffe0b2; }

        .panel { 
            background: white; 
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 15px; 
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: box-shadow 0.2s;
        }
        
        .panel:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .panel h3 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-bg);
        }
        
        .cache-controls { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-top: 10px; 
        }
        
        /* BUTTONS - Modern White Theme */
        button { 
            background: var(--accent); 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button:hover { 
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        button.warning { 
            background: var(--warning); 
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.2);
        }
        
        button.success { 
            background: var(--success); 
            box-shadow: 0 2px 4px rgba(39, 174, 96, 0.2);
        }
        
        button.secondary { 
            background: #95a5a6; 
            box-shadow: 0 2px 4px rgba(149, 165, 166, 0.2);
        }
        
        button.point { 
            background: #8e44ad; 
            box-shadow: 0 2px 4px rgba(142, 68, 173, 0.2);
        }
        
        button.info { 
            background: #3498db; 
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.2);
        }
        
        button.firebase { 
            background: linear-gradient(135deg, #FFA611 0%, #F57C00 100%); 
            box-shadow: 0 2px 4px rgba(255, 166, 17, 0.3);
        }
        
        /* INPUTS & SELECTS - White Theme */
        input, select, textarea { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            border-radius: 8px; 
            border: 1px solid var(--border);
            box-sizing: border-box;
            font-size: 0.9rem;
            background: white;
            color: var(--text-primary);
            transition: all 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .small-input {
            font-size: 0.85rem !important;
            padding: 10px !important;
        }
        
        .property-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 10px 0;
        }
        
        .property-fields.full-width {
            grid-template-columns: 1fr;
        }
        
        .field-group {
            margin: 8px 0;
        }
        
        .field-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.85rem;
        }
        
        .required::after {
            content: " *";
            color: var(--warning);
        }
        
        .optional::after {
            content: " (Optional)";
            color: var(--text-secondary);
            font-size: 0.8em;
            font-weight: normal;
        }
        
        .registration-type-toggle {
            display: flex;
            margin: 15px 0;
            background: var(--light-bg);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .registration-type-toggle button {
            flex: 1;
            border-radius: 0;
            padding: 12px;
            background: transparent;
            color: var(--text-secondary);
            box-shadow: none;
        }
        
        .registration-type-toggle button.active {
            background: var(--accent);
            color: white;
        }
        
        .location-toggle {
            display: flex;
            margin: 15px 0;
            background: var(--light-bg);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .location-toggle button {
            flex: 1;
            border-radius: 0;
            padding: 12px;
            background: transparent;
            color: var(--text-secondary);
            box-shadow: none;
        }
        
        .location-toggle button.active {
            background: var(--accent);
            color: white;
        }
        
        .gps-status {
            padding: 15px;
            margin: 15px 0;
            background: var(--light-bg);
            border-radius: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--border);
        }
        
        .gps-accuracy-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 8px 0;
            overflow: hidden;
        }
        
        .gps-accuracy-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s, background 0.5s;
        }
        
        .gps-status-text {
            font-size: 0.8rem;
            text-align: center;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .table-container { 
            background: var(--light-bg); 
            border-radius: 8px; 
            overflow-x: auto; 
            max-height: 180px;
            font-size: 0.8rem; 
            flex-grow: 1;
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }
        
        .log-container {
            background: var(--light-bg);
            border-radius: 8px;
            overflow-x: auto;
            max-height: 180px;
            font-size: 0.8rem;
            flex-grow: 1;
            margin-bottom: 10px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        
        .log-header {
            padding: 12px;
            background: white;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }
        
        .log-content {
            padding: 12px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .log-entry {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid var(--accent);
            font-size: 0.8rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .log-entry.success {
            border-left-color: var(--success);
            background: linear-gradient(to right, #e8f6ef 0%, white 100%);
        }
        
        .log-entry.warning {
            border-left-color: var(--valuation);
            background: linear-gradient(to right, #fef9e7 0%, white 100%);
        }
        
        .log-entry.error {
            border-left-color: var(--warning);
            background: linear-gradient(to right, #fdeaea 0%, white 100%);
        }
        
        .log-entry.firebase {
            border-left-color: var(--firebase);
            background: linear-gradient(to right, #fff3e0 0%, white 100%);
        }
        
        .log-time {
            color: var(--text-secondary);
            font-size: 0.7rem;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .log-message {
            color: var(--text-primary);
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
        }
        
        th, td { 
            padding: 10px 12px; 
            text-align: left; 
            border-bottom: 1px solid var(--border); 
        }
        
        th {
            background: white;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.8rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:hover { 
            background: rgba(52, 152, 219, 0.05); 
            cursor: pointer; 
        }
        
        .preview-panel {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid var(--border);
            border-left: 4px solid var(--accent);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .preview-panel h4 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--primary);
            border-bottom: 2px solid var(--light-bg);
            padding-bottom: 10px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            font-size: 0.9rem;
        }
        
        .preview-item {
            margin-bottom: 8px;
        }
        
        .preview-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 2px;
        }
        
        .preview-value {
            color: var(--text-primary);
            word-break: break-word;
        }
        
        .evidence-container {
            margin: 15px 0;
        }
        
        .camera-btn {
            width: 100%;
            margin: 5px 0;
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%) !important;
            color: white;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 150px;
            margin-top: 10px;
            border-radius: 8px;
            display: none;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        #coordinates {
            font-size: 0.85rem;
            color: var(--text-primary);
            text-align: center;
            padding: 12px;
            background: var(--light-bg);
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid var(--border);
            font-weight: 500;
        }
        
        @media (max-width: 768px) { 
            body { flex-direction: column; } 
            #sidebar { width: 100%; height: 50%; } 
            #map { height: 50%; } 
        }
        
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .map-controls button {
            background: white;
            color: var(--primary);
            border-radius: 8px;
            padding: 12px 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid var(--border);
            width: 45px;
            height: 45px;
        }
        
        .manual-marker {
            background: none;
            border: none;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .gps-accuracy-threshold {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            z-index: 1000;
            border-left: 4px solid var(--accent);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }
        
        .auto-center-control {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .auto-center-control button {
            background: white;
            color: var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid var(--border);
        }
        
        .auto-center-control button.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .storage-status {
            padding: 15px;
            margin: 15px 0;
            background: var(--light-bg);
            border-radius: 8px;
            font-size: 0.9rem;
            border: 1px solid var(--border);
        }
        
        .storage-bar {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 12px 0;
            overflow: hidden;
        }
        
        .storage-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, #27ae60, #f39c12);
            transition: width 0.5s;
        }
        
        .storage-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .storage-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .modal h3 {
            margin-top: 0;
            color: var(--primary);
            border-bottom: 2px solid var(--light-bg);
            padding-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .data-backup {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .section-title {
            color: var(--primary);
            font-size: 0.95rem;
            margin: 20px 0 10px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--light-bg);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Danger confirmation modal styles */
        .danger-confirmation {
            z-index: 5000;
        }
        
        .danger-modal {
            background: white;
            border: 2px solid #e74c3c;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(231, 76, 60, 0.15);
            animation: danger-pulse 2s infinite;
        }
        
        @keyframes danger-pulse {
            0% { box-shadow: 0 0 20px rgba(231, 76, 60, 0.15); }
            50% { box-shadow: 0 0 40px rgba(231, 76, 60, 0.25); }
            100% { box-shadow: 0 0 20px rgba(231, 76, 60, 0.15); }
        }
        
        .danger-modal h3 {
            color: #e74c3c !important;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
            text-align: center;
        }
        
        .danger-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%) !important;
            color: white !important;
            font-weight: 600 !important;
            border: none !important;
        }
        
        .danger-btn:disabled {
            opacity: 0.5 !important;
            cursor: not-allowed !important;
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%) !important;
        }
        
        /* User info in status bar */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            background: rgba(52, 152, 219, 0.1);
            padding: 8px 12px;
            border-radius: 20px;
            color: var(--accent);
            font-weight: 500;
        }
        
        .logout-btn {
            background: transparent !important;
            color: #e74c3c !important;
            padding: 4px 8px !important;
            font-size: 0.75rem !important;
            border: 1px solid #e74c3c !important;
            box-shadow: none !important;
        }
        
        .logout-btn:hover {
            background: #e74c3c !important;
            color: white !important;
        }
        
        /* Auto-backup notification */
        .auto-backup-notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent) 0%, #2980b9 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 4000;
            display: none;
            align-items: center;
            gap: 12px;
            animation: slideUp 0.3s ease-out;
            border: none;
        }
        
        .firebase-sync-notification {
            background: linear-gradient(135deg, var(--firebase) 0%, #F57C00 100%) !important;
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        .auto-backup-notification i {
            font-size: 1.2rem;
        }
        
        .auto-backup-notification span {
            font-weight: 600;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--light-bg);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* Leaflet map controls - White theme */
        .leaflet-control-zoom {
            border: 1px solid var(--border) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
            border-radius: 8px !important;
            overflow: hidden;
        }
        
        .leaflet-control-zoom a {
            background: white !important;
            color: var(--text-primary) !important;
            border-bottom: 1px solid var(--border) !important;
            width: 36px !important;
            height: 36px !important;
            line-height: 36px !important;
        }
        
        .leaflet-control-zoom a:hover {
            background: var(--light-bg) !important;
        }
        
        .leaflet-control-attribution {
            background: rgba(255, 255, 255, 0.9) !important;
            color: var(--text-secondary) !important;
            border: 1px solid var(--border) !important;
            border-radius: 4px !important;
            padding: 4px 8px !important;
            font-size: 0.75rem !important;
        }
        
        /* Toggle switch for manual entry */
        .manual-entry-toggle {
            margin-top: 8px;
            font-size: 0.8rem;
        }
        
        .toggle-link {
            color: var(--accent);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 500;
        }
        
        .toggle-link:hover {
            color: #2980b9;
        }
        
        /* Sync status indicator */
        .sync-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .sync-pending { background: #fff3cd; color: #856404; }
        .sync-synced { background: #d4edda; color: #155724; }
        .sync-failed { background: #f8d7da; color: #721c24; }
        .sync-queued { background: #cce5ff; color: #004085; }
        
        /* Firebase status panel */
        .firebase-status {
            padding: 12px;
            margin: 10px 0;
            background: #fff3e0;
            border-radius: 8px;
            font-size: 0.85rem;
            border: 1px solid #ffe0b2;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .firebase-status.online {
            background: #e8f5e9;
            border-color: #c8e6c9;
        }
        
        .firebase-status.offline {
            background: #ffebee;
            border-color: #ffcdd2;
        }
        
        .firebase-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .firebase-stat {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border);
            text-align: center;
        }
        
        .firebase-stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .firebase-stat-value {
            font-size: 1rem;
            color: var(--firebase);
            font-weight: 600;
        }
    </style>
</head>
<body>

<!-- LOGIN MODAL (MANDATORY) -->
<div id="loginModal">
    <div class="login-container">
        <div class="login-logo">
            <i class="fa-solid fa-map-location-dot"></i>
        </div>
        
        <h2><i class="fa-solid fa-lock"></i> LAVMIS ACCESS</h2>
        
        <div class="login-input-group">
            <label for="username"><i class="fa-solid fa-user"></i> EMAIL</label>
            <input type="email" id="username" placeholder="Enter your email" autocomplete="username" required>
        </div>
        
        <div class="login-input-group">
            <label for="password"><i class="fa-solid fa-key"></i> PASSWORD</label>
            <input type="password" id="password" placeholder="Enter password" autocomplete="current-password" required>
        </div>
        
        <div class="login-error" id="loginError"></div>
        
        <div class="login-attempts" id="loginAttempts">
            Attempts remaining: 5
        </div>
        
        <button class="login-button" id="loginButton" onclick="attemptLogin()">
            <i class="fa-solid fa-right-to-bracket"></i> LOGIN TO LAVMIS
        </button>
        
        <div class="login-footer">
            <p><i class="fa-solid fa-triangle-exclamation"></i> Authorized Personnel Only</p>
            <p style="font-size: 0.7rem; color: #7f8c8d;">District Valuation & Market Analysis System</p>
            <p style="font-size: 0.7rem; color: #FFA611; margin-top: 5px;">
                <i class="fa-solid fa-cloud"></i> Firebase Cloud Sync Enabled
            </p>
        </div>
    </div>
</div>

<!-- BACKUP PROGRESS MODAL -->
<div id="backupProgressModal">
    <div class="backup-progress-container">
        <h3><i class="fa-solid fa-download"></i> CREATING BACKUP</h3>
        
        <div class="progress-bar">
            <div class="progress-fill" id="backupProgressFill"></div>
        </div>
        
        <div class="progress-text" id="backupProgressText">Preparing backup...</div>
        
        <div class="backup-stats">
            <div class="backup-stat">
                <div class="backup-stat-label">Records to backup</div>
                <div class="backup-stat-value" id="backupRecordCount">0</div>
            </div>
            <div class="backup-stat">
                <div class="backup-stat-label">Backup Size</div>
                <div class="backup-stat-value" id="backupSize">0 MB</div>
            </div>
        </div>
        
        <div class="backup-success" id="backupSuccess">
            <i class="fa-solid fa-check-circle"></i>
            <div style="font-weight: bold; margin-bottom: 5px;">Backup Completed Successfully!</div>
            <div style="font-size: 0.8rem;" id="backupFileName">Backup file has been saved</div>
        </div>
        
        <div style="margin-top: 20px;">
            <button id="continueLogoutBtn" class="success" onclick="finishLogout()" style="display: none; width: 100%;">
                <i class="fa-solid fa-right-from-bracket"></i> Continue with Logout
            </button>
            <button id="cancelBackupBtn" class="secondary" onclick="cancelBackup()" style="width: 100%;">
                <i class="fa-solid fa-times"></i> Cancel
            </button>
        </div>
    </div>
</div>

<!-- AUTO-BACKUP NOTIFICATION -->
<div class="auto-backup-notification" id="autoBackupNotification">
    <i class="fa-solid fa-shield-alt"></i>
    <div>
        <span>Auto-backup in progress...</span>
        <div style="font-size: 0.8rem; opacity: 0.9;">Data is being backed up before logout</div>
    </div>
</div>

<!-- FIREBASE SYNC NOTIFICATION -->
<div class="auto-backup-notification firebase-sync-notification" id="firebaseSyncNotification">
    <i class="fa-solid fa-cloud-upload-alt"></i>
    <div>
        <span id="firebaseSyncMessage">Firebase sync in progress...</span>
        <div style="font-size: 0.8rem; opacity: 0.9;" id="firebaseSyncDetails">Syncing data to cloud</div>
    </div>
</div>

<!-- MAIN CONTENT (HIDDEN UNTIL LOGIN) -->
<div id="mainContent">
    <div id="sidebar">
        <div class="status-bar">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span id="net-label" class="indicator on">ONLINE</span>
                <span id="firebase-status-ind" class="indicator firebase-ind" style="display: none;">
                    <i class="fa-solid fa-cloud"></i> FIREBASE
                </span>
                <div class="user-info" id="userInfo">
                    <i class="fa-solid fa-user-check"></i>
                    <span id="loggedInUser">User</span>
                    <button class="logout-btn" onclick="initiateLogout()" title="Logout" id="logoutBtn">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </button>
                </div>
            </div>
            <span style="font-size: 1.2rem; font-weight: bold; color: var(--valuation);">LAVMIS DATA COLLECTOR MODULE</span>
        </div>

        <!-- Firebase Status Panel -->
        <div class="panel" id="firebaseStatusPanel" style="display: none;">
            <h3><i class="fa-solid fa-fire"></i> Firebase Cloud Status</h3>
            
            <div class="firebase-status" id="firebaseConnectionStatus">
                <i class="fa-solid fa-cloud"></i>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 600; font-size: 0.9rem;" id="firebaseStatusText">Connecting to Firebase...</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);" id="firebaseStatusDetail">
                        Syncing with cloud database
                    </div>
                </div>
            </div>
            
            <div class="firebase-stats">
                <div class="firebase-stat">
                    <div class="firebase-stat-label">Synced Records</div>
                    <div class="firebase-stat-value" id="syncedRecords">0</div>
                </div>
                <div class="firebase-stat">
                    <div class="firebase-stat-label">Pending Sync</div>
                    <div class="firebase-stat-value" id="pendingSync">0</div>
                </div>
            </div>
            
            <button onclick="syncAllToFirebase()" class="firebase" style="width: 100%; margin-top: 10px;">
                <i class="fa-solid fa-cloud-arrow-up"></i> Sync All to Firebase
            </button>
        </div>

        <div class="panel">
            <h3><i class="fa-solid fa-map"></i> Offline Map Cache</h3>
            <p style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.4;">Zoom into your project area while online, then click "Cache Visible Area" to save imagery for offline use.</p>
            <div class="cache-controls">
                <button onclick="cacheTiles()" style="background: var(--valuation); color: white;">
                    <i class="fa-solid fa-download"></i> Cache Area
                </button>
                <button onclick="clearCache()" class="secondary">
                    <i class="fa-solid fa-trash"></i> Clear Map
                </button>
            </div>
            <div id="cache-status" style="font-size: 0.8rem; margin-top: 10px; color: var(--text-secondary);">
                <i class="fa-solid fa-hard-drive"></i> Storage Used: Calculating...
            </div>
        </div>

        <div class="panel">
            <h3><i class="fa-solid fa-location-crosshairs"></i> Data Capture</h3>
            
            <div class="section-title">
                <i class="fa-solid fa-id-card"></i> Property Information
            </div>
            
            <div class="property-fields">
                <div class="field-group">
                    <label for="propertyId" class="required">Property ID</label>
                    <input type="text" id="propertyId" placeholder="Auto-generated" class="small-input" readonly>
                    <span id="propertySyncStatus" class="sync-status" style="display: none;"></span>
                </div>
                <div class="field-group">
                    <label for="propertyName" class="optional">Property Name</label>
                    <input type="text" id="propertyName" placeholder="Enter Property Name (Optional)" class="small-input">
                </div>
            </div>
            
            <div class="section-title">
                <i class="fa-solid fa-file-signature"></i> Registration Type
            </div>
            
            <div class="registration-type-toggle" id="registrationTypeToggle">
                <button id="titledToggle" class="active" onclick="setRegistrationType('titled')">
                    <i class="fa-solid fa-file-contract"></i> Titled
                </button>
                <button id="untitledToggle" onclick="setRegistrationType('untitled')">
                    <i class="fa-solid fa-file-alt"></i> Untitled
                </button>
            </div>
            
            <div class="property-fields" id="titleFields">
                <div class="field-group">
                    <label for="plotNumber">Plot Number</label>
                    <input type="text" id="plotNumber" placeholder="Enter Plot Number" class="small-input">
                </div>
                <div class="field-group">
                    <label for="blockNumber">Block Number</label>
                    <input type="text" id="blockNumber" placeholder="Enter Block Number" class="small-input">
                </div>
            </div>
            
            <div class="section-title">
                <i class="fa-solid fa-location-dot"></i> Location Information
            </div>
            
            <div class="property-fields full-width">
                <div class="field-group">
                    <label for="districtCity" class="required">District/City</label>
                    <select id="districtCity" class="small-input" onchange="updateSubcounties()">
                        <option value="">Select District/City</option>
                    </select>
                    <div class="manual-entry-toggle">
                        <span class="toggle-link" onclick="toggleManualEntry('districtCity')">Not in list? Type manually</span>
                    </div>
                    <input type="text" id="districtCityManual" placeholder="Type District/City manually" class="small-input" style="display: none;">
                </div>
            </div>
            
            <div class="property-fields">
                <div class="field-group">
                    <label for="subcounty" class="required">Subcounty</label>
                    <select id="subcounty" class="small-input" onchange="updateParishes()" disabled>
                        <option value="">Select Subcounty</option>
                    </select>
                    <div class="manual-entry-toggle">
                        <span class="toggle-link" onclick="toggleManualEntry('subcounty')">Not in list? Type manually</span>
                    </div>
                    <input type="text" id="subcountyManual" placeholder="Type Subcounty manually" class="small-input" style="display: none;">
                </div>
                <div class="field-group">
                    <label for="parish" class="required">Parish</label>
                    <select id="parish" class="small-input" onchange="updateVillages()" disabled>
                        <option value="">Select Parish</option>
                    </select>
                    <div class="manual-entry-toggle">
                        <span class="toggle-link" onclick="toggleManualEntry('parish')">Not in list? Type manually</span>
                    </div>
                    <input type="text" id="parishManual" placeholder="Type Parish manually" class="small-input" style="display: none;">
                </div>
            </div>
            
            <div class="property-fields full-width">
                <div class="field-group">
                    <label for="village" class="required">Village</label>
                    <select id="village" class="small-input" disabled>
                        <option value="">Select Village</option>
                    </select>
                    <div class="manual-entry-toggle">
                        <span class="toggle-link" onclick="toggleManualEntry('village')">Not in list? Type manually</span>
                    </div>
                    <input type="text" id="villageManual" placeholder="Type Village manually" class="small-input" style="display: none;">
                </div>
            </div>
            
            <div class="property-fields full-width">
                <div class="field-group">
                    <label for="description" class="optional">Description/Remarks</label>
                    <textarea id="description" placeholder="Enter any remarks or description about the property" rows="3" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: white; color: var(--text-primary); font-size: 0.9rem; resize: vertical;"></textarea>
                </div>
            </div>
            
            <div class="property-fields full-width">
                <div class="field-group">
                    <label for="dataSource" class="required">Data Source</label>
                    <select id="dataSource" class="small-input">
                        <option value="">Select Data Source</option>
                        <option value="Field Survey">Field Survey</option>
                        <option value="Land Registry">Land Registry</option>
                        <option value="Local Government">Local Government</option>
                        <option value="Property Owner">Property Owner</option>
                        <option value="Real Estate Agent">Real Estate Agent</option>
                        <option value="Community Leader">Community Leader</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            
            <div class="section-title">
                <i class="fa-solid fa-chart-line"></i> Location & Valuation
            </div>
            
            <div class="location-toggle">
                <button id="gpsToggle" class="active" onclick="setLocationMode('gps')">
                    <i class="fa-solid fa-satellite"></i> GPS Auto
                </button>
                <button id="manualToggle" onclick="setLocationMode('manual')">
                    <i class="fa-solid fa-map-pin"></i> Map Point
                </button>
            </div>
            
            <div class="gps-status">
                <i class="fa-solid fa-satellite" id="gpsIcon" style="color: var(--accent); font-size: 1.2rem;"></i>
                <div style="flex-grow: 1;">
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem; font-weight: 500;">
                        <span id="gpsStatusText">Acquiring GPS...</span>
                        <span id="gpsAccuracy" style="color: var(--primary);">-- m</span>
                    </div>
                    <div class="gps-accuracy-bar">
                        <div id="gpsAccuracyFill" class="gps-accuracy-fill" style="width: 0%; background: #e74c3c;"></div>
                    </div>
                    <div class="gps-status-text" id="gpsStatusDetail">
                        Need 3-20m accuracy to save data
                    </div>
                </div>
            </div>
            
            <div id="coordinates">Waiting for GPS...</div>
            
            <div style="margin: 15px 0;">
                <button onclick="clearManualPoint()" class="secondary" style="width: 100%;" id="clearPointBtn" disabled>
                    <i class="fa-solid fa-trash"></i> Clear Selected Point
                </button>
            </div>
            
            <div class="property-fields">
                <div class="field-group">
                    <label for="price" class="required">Total Price ($)</label>
                    <input type="number" id="price" placeholder="Total Price" step="0.01">
                </div>
                <div class="field-group">
                    <label for="size" class="required">Size (Ha)</label>
                    <input type="number" id="size" placeholder="Size (Ha)" step="0.01">
                </div>
            </div>
            
            <div class="field-group">
                <label for="use" class="required">Land Use</label>
                <select id="use">
                    <option value="">Select Land Use</option>
                    <option>Residential</option>
                    <option>Commercial</option>
                    <option>Agricultural</option>
                    <option>Industrial</option>
                    <option>Recreational</option>
                    <option>Mixed Use</option>
                    <option>Vacant Land</option>
                    <option>Forest</option>
                    <option>Wetland</option>
                </select>
            </div>
            
            <div class="section-title">
                <i class="fa-solid fa-camera"></i> Evidence
            </div>
            
            <div class="evidence-container">
                <button class="camera-btn" onclick="capturePhoto()">
                    <i class="fa-solid fa-camera"></i> ADD EVIDENCE PHOTO (Optional)
                </button>
                <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;" onchange="handlePhotoUpload(event)">
                <img id="imagePreview" class="image-preview" alt="Evidence Preview">
                <button id="removePhotoBtn" class="warning" onclick="removePhoto()" style="display: none; width: 100%; margin-top: 10px;">
                    <i class="fa-solid fa-trash"></i> Remove Photo
                </button>
            </div>
            
            <div class="section-title">
                <i class="fa-solid fa-user-tie"></i> Data Collector Information
            </div>
            
            <div class="property-fields full-width">
                <div class="field-group">
                    <label for="officerName" class="required">Name of Officer (Data Collector)</label>
                    <input type="text" id="officerName" placeholder="Enter your full name">
                </div>
            </div>
            
            <button id="saveBtn" onclick="saveData()" class="success" style="width: 100%; margin-top: 15px; padding: 14px;" disabled>
                <i class="fa-solid fa-save"></i> SAVE PROPERTY RECORD
            </button>
        </div>

        <div class="panel">
            <h3><i class="fa-solid fa-database"></i> Storage Status</h3>
            
            <div class="firebase-status" id="syncStatusInfo" style="display: none;">
                <i class="fa-solid fa-cloud"></i>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 600; font-size: 0.9rem;">Cloud Sync Status</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);">
                        <span id="syncStatusText">Checking sync status...</span>
                    </div>
                </div>
            </div>
            
            <div class="storage-status">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: 500;">
                    <span>Local Data Usage</span>
                    <span id="recordCount">0 records</span>
                </div>
                <div class="storage-bar">
                    <div id="storageFill" class="storage-fill" style="width: 0%"></div>
                </div>
                <div class="storage-info">
                    <span id="storageUsed">0 MB</span>
                    <span id="storageTotal">Calculating...</span>
                </div>
            </div>
            
            <div class="storage-actions">
                <button onclick="showBackupModal()" class="info">
                    <i class="fa-solid fa-download"></i> Backup
                </button>
                <button onclick="showRestoreModal()" class="secondary">
                    <i class="fa-solid fa-upload"></i> Restore
                </button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                <button onclick="syncAllToFirebase()" class="firebase">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Sync Cloud
                </button>
                <button onclick="restoreFromFirebase()" class="warning">
                    <i class="fa-solid fa-cloud-arrow-down"></i> Restore Cloud
                </button>
            </div>
            
            <button onclick="clearAllData()" class="warning" style="width: 100%; margin-top: 15px;">
                <i class="fa-solid fa-trash"></i> Clear All Data
            </button>
        </div>

        <div class="table-container">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>Property ID</th>
                        <th>Name</th>
                        <th>Plot No.</th>
                        <th>Rate/Ha</th>
                        <th>Sync</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <div class="log-container">
            <div class="log-header">
                <h4 style="margin: 0; font-size: 1rem;"><i class="fa-solid fa-clipboard-list"></i> Activity Log</h4>
                <button onclick="clearLog()" class="secondary" style="padding: 6px 10px; font-size: 0.8rem;">
                    <i class="fa-solid fa-trash"></i> Clear
                </button>
            </div>
            <div class="log-content" id="logContent">
                <!-- Log entries will be added here -->
            </div>
        </div>
        
        <div id="dataPreview" class="preview-panel">
            <h4><i class="fa-solid fa-eye"></i> PROPERTY RECORD PREVIEW</h4>
            <div class="preview-grid" id="previewContent">
                <!-- Preview content will be injected here -->
            </div>
            <button onclick="hidePreview()" class="secondary" style="width: 100%; margin-top: 15px;">
                <i class="fa-solid fa-times"></i> Close Preview
            </button>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px;">
            <button onclick="exportData()" class="success">
                <i class="fa-solid fa-file-excel"></i> Export Excel
            </button>
            <button onclick="exportGeoJSON()" class="info">
                <i class="fa-solid fa-globe"></i> Export GeoJSON
            </button>
        </div>
    </div>

    <div id="map"></div>

    <div class="gps-accuracy-threshold" id="accuracyThreshold">
        <i class="fa-solid fa-bullseye"></i> GPS Accuracy: 3-20m required
    </div>

    <div class="auto-center-control">
        <button id="autoCenterToggle" onclick="toggleAutoCenter()" title="Auto-center on GPS">
            <i class="fa-solid fa-location-crosshairs"></i>
        </button>
    </div>

    <div class="map-controls">
        <button onclick="centerOnGPS()" title="Center on GPS" id="centerGPSBtn">
            <i class="fa-solid fa-location-arrow"></i>
        </button>
        <button onclick="clearAllMarkers()" class="warning" title="Clear all markers">
            <i class="fa-solid fa-trash"></i>
        </button>
    </div>

    <!-- Backup Modal -->
    <div id="backupModal" class="modal-overlay">
        <div class="modal">
            <h3><i class="fa-solid fa-download"></i> Data Backup</h3>
            <p style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">Backup your data to a file or to Firebase Cloud.</p>
            
            <div class="data-backup">
                <button onclick="backupData('json')" class="info">
                    <i class="fa-solid fa-code"></i> Backup as JSON
                </button>
                <button onclick="backupData('csv')" class="success">
                    <i class="fa-solid fa-file-csv"></i> Backup as CSV
                </button>
                <button onclick="backupToFirebase()" class="firebase" style="grid-column: span 2;">
                    <i class="fa-solid fa-cloud-upload-alt"></i> Backup to Firebase
                </button>
            </div>
            
            <div style="margin-top: 20px;">
                <h4 style="font-size: 1rem;"><i class="fa-solid fa-file-export"></i> Export Formats</h4>
                <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5;">
                    <p><strong>JSON</strong>: Full data including photos (base64 encoded)</p>
                    <p><strong>CSV</strong>: Tabular data only (photos excluded)</p>
                    <p><strong>Firebase</strong>: Cloud backup with real-time sync</p>
                </div>
            </div>
            
            <button onclick="hideModal()" class="secondary" style="width: 100%; margin-top: 20px;">
                <i class="fa-solid fa-times"></i> Close
            </button>
        </div>
    </div>

    <!-- Restore Modal -->
    <div id="restoreModal" class="modal-overlay">
        <div class="modal">
            <h3><i class="fa-solid fa-upload"></i> Data Restore</h3>
            <p style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">Restore data from a previously created backup file or from Firebase Cloud.</p>
            
            <div style="margin: 20px 0;">
                <input type="file" id="restoreFile" accept=".json,.csv" style="width: 100%; padding: 12px; background: white; border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 0.9rem;">
                <button onclick="restoreData()" class="success" style="width: 100%; margin-top: 15px;">
                    <i class="fa-solid fa-upload"></i> Restore from File
                </button>
            </div>
            
            <div style="margin: 20px 0;">
                <button onclick="restoreFromFirebase()" class="firebase" style="width: 100%;">
                    <i class="fa-solid fa-cloud-arrow-down"></i> Restore from Firebase
                </button>
            </div>
            
            <div style="background: #fef9e7; padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px solid #fcf3cf;">
                <h4 style="margin: 0 0 10px 0; font-size: 0.9rem; color: #f39c12;">
                    <i class="fa-solid fa-triangle-exclamation"></i> Warning
                </h4>
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0; line-height: 1.5;">
                    Restoring data will replace all existing records. Make sure you have a current backup before proceeding.
                </p>
            </div>
            
            <button onclick="hideModal()" class="secondary" style="width: 100%; margin-top: 20px;">
                <i class="fa-solid fa-times"></i> Close
            </button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
<script src="https://unpkg.com/leaflet.tilelayer.pouchdbcached@1.0.0/L.TileLayer.PouchDBCached.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

<script>
    // ==============================================
    // GLOBAL VARIABLES
    // ==============================================
    let loginSystem = null;
    let map = null;
    let savedLayer = null;
    let liveLayer = null;
    let manualLayer = null;
    let accuracyLayer = null;
    let locationMode = 'gps';
    let registrationType = 'titled';
    let currentPos = null;
    let currentAccuracy = null;
    let manualPos = null;
    let evidencePhoto = null;
    let manualMarker = null;
    let isManualModeActive = false;
    let autoCenterEnabled = true;
    let gpsWatchId = null;
    let lastGpsUpdate = null;
    let logger = null;
    let storageManager = null;
    let satellite = null;
    let propertyIdCounter = 1;
    let firebaseDataManager = null;
    let firebaseApp = null;
    let firebaseDb = null;
    let firebaseAuth = null;
    let currentFirebaseUser = null;

    // ==============================================
    // FIREBASE CONFIGURATION
    // ==============================================
    // IMPORTANT: Replace these values with your Firebase project configuration
    const firebaseConfig = {
        apiKey: "AIzaSyA944hBt8QoOLeRKPoRrl2RemV9vlBc6ug",
        authDomain: "lavmis-1410e.firebaseapp.com",
        projectId: "lavmis-1410e",
        storageBucket: "lavmis-1410e.firebasestorage.app",
        messagingSenderId: "710897502113",
        appId: "1:710897502113:web:e5bfefc423af1b51632de0",
        measurementId: "G-ZWTN2R2RB2"
    };

    // ==============================================
    // EMBEDDED GEOGRAPHICAL DATA FROM JSON
    // ==============================================
    const geographicalData = [
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "01 BUGOMBE",
  "VILLAGES": "01 BUGAZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "01 BUGOMBE",
  "VILLAGES": "02 BUGOMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "01 BUGOMBE",
  "VILLAGES": "03 BULAGO - KAWUNGULI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "01 BUGOMBE",
  "VILLAGES": "04 LWAZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "01 BUGOMBE",
  "VILLAGES": "05 ZINGOOLA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "01 BUKERERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "02 KAGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "03 KIWANGO\/NAMWEZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "04 KYESEREKA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "05 MAWANGALA\/KINAFU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "06 NAKAGERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "07 NAMASIGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "08 NYANJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "01 BUKERERE WARD",
  "VILLAGES": "09 PAPATI\/BUWAVA\/NATONKO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "01 KABIMBIRI A WARD",
  "VILLAGES": "02 KALYOWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "01 KABIMBIRI A WARD",
  "VILLAGES": "07 NASSEJJOBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "01 KABIMBIRI A WARD",
  "VILLAGES": "08 SINDA\/KIVULUBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "01 KABIMBIRI A WARD",
  "VILLAGES": "09 CENTRAL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "01 KABIMBIRI A WARD",
  "VILLAGES": "10 EDUCATIONAL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "02 BUSANGA",
  "VILLAGES": "01 BUSANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "02 BUSANGA",
  "VILLAGES": "02 KANSAMBWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "02 BUSANGA",
  "VILLAGES": "03 KIMMI-BANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "02 BUSANGA",
  "VILLAGES": "04 KISIGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "02 BUSANGA",
  "VILLAGES": "05 LUBEMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "02 BUSANGA",
  "VILLAGES": "06 NGAGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "02 BUSANGA",
  "VILLAGES": "07 TABALIRO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "02 KAKUKUULU",
  "VILLAGES": "01 BUGABO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "02 KAKUKUULU",
  "VILLAGES": "02 KAKUKULU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "02 KAKUKUULU",
  "VILLAGES": "03 KIKUBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "02 KAKUKUULU",
  "VILLAGES": "04 KIWERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "02 KAKUKUULU",
  "VILLAGES": "05 KIZANYIRIZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "02 KAKUKUULU",
  "VILLAGES": "06 NAKASWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "02 KAKUKUULU",
  "VILLAGES": "07 NAKIDUDUMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "02 KAKUKUULU",
  "VILLAGES": "08 NKOKO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "02 MISINDYE WARD",
  "VILLAGES": "01 GOMA - MISINDYE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "02 MISINDYE WARD",
  "VILLAGES": "02 JINJA - MISINDYE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "02 MISINDYE WARD",
  "VILLAGES": "03 JJOGGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "02 MISINDYE WARD",
  "VILLAGES": "04 LUMULI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "02 MISINDYE WARD",
  "VILLAGES": "05 NAMYOOYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "02 MISINDYE WARD",
  "VILLAGES": "06 SONDE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "03 KASANA",
  "VILLAGES": "01 BUTEYONGERA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "03 KASANA",
  "VILLAGES": "02 KAKIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "03 KASANA",
  "VILLAGES": "03 KASALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "03 KASANA",
  "VILLAGES": "04 KASANA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "03 KASANA",
  "VILLAGES": "05 KITWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "03 KASANA",
  "VILLAGES": "06 KIYAGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "03 KASANA",
  "VILLAGES": "07 NDIBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "01 BUUJE\/KITOSI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "02 BUYANA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "03 KAKUNYU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "04 LUGUMBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "05 LWANGAMUTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "06 LWOMOLO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "07 MISENYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "08 KASENYI - BUSI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "03 LWOMOLO",
  "VILLAGES": "09 NAMUGAMBE - KIBATIIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "03 NANTABULIRWA WARD",
  "VILLAGES": "01 DEGEYA-SSENYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "03 NANTABULIRWA WARD",
  "VILLAGES": "02 KASOKOSO-SAGALANKOKO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "03 NANTABULIRWA WARD",
  "VILLAGES": "03 KITALE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "03 NANTABULIRWA WARD",
  "VILLAGES": "04 KIWANGA-RWANDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "03 NANTABULIRWA WARD",
  "VILLAGES": "05 KKOLO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "03 NANTABULIRWA WARD",
  "VILLAGES": "06 MAWOTTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "03 NANTABULIRWA WARD",
  "VILLAGES": "07 NAMILYANGO-KISENYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "03 NANTABULIRWA WARD",
  "VILLAGES": "08 NANTABULIRWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "04 KIGOGOLA",
  "VILLAGES": "01 BUYUKI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "04 KIGOGOLA",
  "VILLAGES": "02 KATEETE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "04 KIGOGOLA",
  "VILLAGES": "03 KIBAMBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "04 KIGOGOLA",
  "VILLAGES": "04 KIGOGOLA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "04 KIGOGOLA",
  "VILLAGES": "05 KISONZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "04 KIGOGOLA",
  "VILLAGES": "06 NNONGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "04 KIGOGOLA",
  "VILLAGES": "07 NSANVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "01 BATWALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "02 KALYAMBUZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "03 NAMBU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "04 KATOLO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "05 KISU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "06 MUBEMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "07 MUWOMA - KAKEEKA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "08 NYANAMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KOOME ISLANDS",
  "PARISH": "04 MUBEMBE",
  "VILLAGES": "09 MAALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "04 NYENJE WARD",
  "VILLAGES": "01 BAJJO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "04 NYENJE WARD",
  "VILLAGES": "02 BUDDUGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "04 NYENJE WARD",
  "VILLAGES": "03 KIGUUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "04 NYENJE WARD",
  "VILLAGES": "04 NSAMBWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "04 NYENJE WARD",
  "VILLAGES": "05 NYENJE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "05 KATENTE",
  "VILLAGES": "01 GAMBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "05 KATENTE",
  "VILLAGES": "02 KATENTE 'A'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "05 KATENTE",
  "VILLAGES": "03 KATENTE 'B'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "05 KATENTE",
  "VILLAGES": "04 KATWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "05 KATENTE",
  "VILLAGES": "05 KISOKO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "05 KATENTE",
  "VILLAGES": "06 LUGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "05 KATENTE",
  "VILLAGES": "07 NTOVE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "05 KATENTE",
  "VILLAGES": "08 WANKATA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "05 KITOVU WARD",
  "VILLAGES": "03 KIGAYAZA  I"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "05 KITOVU WARD",
  "VILLAGES": "05 KITUNKU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "05 KITOVU WARD",
  "VILLAGES": "06 MINDI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "01 BAGGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "02 BUGOBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "03 GONGOBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "04 GULAMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "05 GWAFU CENTRAL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "06 GWAFU WEST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "07 KIROWOZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "08 NABUTA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "09 NJERERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 GOMA DIVISION",
  "PARISH": "05 SEETA WARD",
  "VILLAGES": "10 NTINDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "06 BULIKA",
  "VILLAGES": "01 BULIKA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "06 BULIKA",
  "VILLAGES": "02 LUTENGO 'A'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "06 BULIKA",
  "VILLAGES": "03 LUTENGO 'B'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "06 BULIKA",
  "VILLAGES": "04 NAMULUGWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "06 BULIKA",
  "VILLAGES": "05 WABUNUNU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "06 BULIKA",
  "VILLAGES": "06 WAKISO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "06 KIYOOLA",
  "VILLAGES": "01 BANDA-SUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "06 KIYOOLA",
  "VILLAGES": "02 BUMBAJJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "06 KIYOOLA",
  "VILLAGES": "03 BUZZU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "06 KIYOOLA",
  "VILLAGES": "04 KISOZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "06 KIYOOLA",
  "VILLAGES": "05 KIYOOLA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "06 KIYOOLA",
  "VILLAGES": "06 NANTUULA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "06 KIYOOLA",
  "VILLAGES": "07 NASSAKA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "06 KIYOOLA",
  "VILLAGES": "08 NSONGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "06 NAMALIRI",
  "VILLAGES": "01 GAVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "06 NAMALIRI",
  "VILLAGES": "02 KAWUTUTU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "06 NAMALIRI",
  "VILLAGES": "03 KIGULU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "06 NAMALIRI",
  "VILLAGES": "04 NAMALIRI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "01 KASAWO",
  "PARISH": "06 NAMALIRI",
  "VILLAGES": "05 NDESE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "07 BAMUSUUTA-RURAL WARD",
  "VILLAGES": "01 BAMUSUTA A"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "07 BAMUSUUTA-RURAL WARD",
  "VILLAGES": "02 BAMUSUTA B"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "07 BAMUSUUTA-RURAL WARD",
  "VILLAGES": "03 BUSABALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "07 BAMUSUUTA-RURAL WARD",
  "VILLAGES": "04 KAKAKALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "07 BAMUSUUTA-RURAL WARD",
  "VILLAGES": "05 KAYUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "07 BAMUSUUTA-RURAL WARD",
  "VILLAGES": "06 KIYAGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "07 BAMUSUUTA-RURAL WARD",
  "VILLAGES": "08 NALUBABWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "07 KASENGE",
  "VILLAGES": "01 KAPEKE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "07 KASENGE",
  "VILLAGES": "02 KASENGE 'A'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "07 KASENGE",
  "VILLAGES": "03 KASENGE 'B'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "07 KASENGE",
  "VILLAGES": "04 KIVUUVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "07 KASENGE",
  "VILLAGES": "05 NAKAPINYI NORTH"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "07 KASENGE",
  "VILLAGES": "06 NAKAPINYI SOUTH"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "07 KYABALOGO",
  "VILLAGES": "01 BANDA-BUGENDERADDALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "07 KYABALOGO",
  "VILLAGES": "02 BANDA-KYANDAAZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "07 KYABALOGO",
  "VILLAGES": "03 LUSERA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "07 KYABALOGO",
  "VILLAGES": "04 NAKISUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "07 KYABALOGO",
  "VILLAGES": "05 NAMAKWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "07 KYABALOGO",
  "VILLAGES": "06 NTAKAFUNVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "01 BUYUKI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "02 KABULA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "03 KAKOOLA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "04 KATOOGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "05 KAYUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "06 LUKALU\/KIMBUGUMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "07 NABITIMPA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "08 SAMUUKA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "08 KATOOGO",
  "VILLAGES": "09 WALUGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "08 NABALANGA RURAL WARD",
  "VILLAGES": "01 KABAWALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "08 NABALANGA RURAL WARD",
  "VILLAGES": "03 LUSANJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "08 NABALANGA RURAL WARD",
  "VILLAGES": "04 MAGOGGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "08 NABALANGA RURAL WARD",
  "VILLAGES": "05 NABALANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "08 NABALANGA RURAL WARD",
  "VILLAGES": "06 NKULAGIRIRE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "01 BUZIRANJOVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "02 KAKUBA-KIYANJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "03 KATUBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "04 KITYABULE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "05 LUBUGUMU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "06 LUWULE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "07 NAMAYIBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "08 SSANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "08 NAMAYIBA",
  "VILLAGES": "09 MAWA\/MANGALIBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "01 BUYUKI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "02 KIBOOBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "03 KISOWERA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "04 KITUBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "05 LUKOJJO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "06 LUWUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "07 MABUYE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "08 MPOMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "09 NALYA - KAMPUNGU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "10 NAMA I"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "11 NAMA II"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "12 NKOOKI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "09 MPOMA",
  "VILLAGES": "13 NSANVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "09 NAGGALAMA A WARD",
  "VILLAGES": "01 GWENDIDDE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "09 NAGGALAMA A WARD",
  "VILLAGES": "02 KALAGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "09 NAGGALAMA A WARD",
  "VILLAGES": "03 KAZINGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "09 NAGGALAMA A WARD",
  "VILLAGES": "04 KIWANGWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "09 NAGGALAMA A WARD",
  "VILLAGES": "05 KIWEBWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "09 NAGGALAMA A WARD",
  "VILLAGES": "10 WABIKOKOMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "09 NAMUYENJE",
  "VILLAGES": "01 KIWUGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "09 NAMUYENJE",
  "VILLAGES": "02 NAKOOSI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "09 NAMUYENJE",
  "VILLAGES": "03 NAMUYENJE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "09 NAMUYENJE",
  "VILLAGES": "04 NANGWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "09 NAMUYENJE",
  "VILLAGES": "05 NTULUMUKO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "09 NAMUYENJE",
  "VILLAGES": "06 KYAWAMBOGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "10 NAMUBIRU",
  "VILLAGES": "01 KIKUBANKIMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "10 NAMUBIRU",
  "VILLAGES": "02 KIRANGIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "10 NAMUBIRU",
  "VILLAGES": "03 LWANYONYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "10 NAMUBIRU",
  "VILLAGES": "04 NAMUBIRU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "10 NAMUBIRU",
  "VILLAGES": "05 TAKAJJUNGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "10 NANKULABYE WARD",
  "VILLAGES": "01 ST. FRANCIS"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "10 NANKULABYE WARD",
  "VILLAGES": "02 ST. LUCIA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "10 NANKULABYE WARD",
  "VILLAGES": "10 NAKULABYE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "01 BUSIMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "02 BUWAALI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "03 KAVULE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "04 KIRIJJA-BUTOOKE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "05 KIRONDO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "06 KIRWANYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "07 KITEZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "08 MAKATA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "09 NAMALIGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "10 SEETA-NAZIGO",
  "VILLAGES": "10 SEETA - NAZIGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "01 BUGEREKA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "02 GONVE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "03 KABULO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "04 KAWOOMYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "05 KIZIMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "06 MAKUKUBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "07 NABBAALE I"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "08 NABBAALE II"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "11 MAKUKUBA WARD",
  "VILLAGES": "09 NAMASENGERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "01 BUGUJJU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "02 KATI-KOLO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "03 KYUNGU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "04 MATERNITY"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "05 MUKONO HILL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "06 NABUTI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "07 NSUUBE 'B'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "08 UPPER KAUGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "11 NSUUBE\/KAUGA WARD",
  "VILLAGES": "09 UPPER NABUTI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "01 BUSAALE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "02 BUSIBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "03 KERITA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "04 KISOLOOZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "05 LUKONGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "06 MWANYANGIRI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "07 NALUVULE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "08 NAMINA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "09 NAWANJUKI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "10 WABINYIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "11 WANKOBA",
  "VILLAGES": "11 WANKOBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "12 BUGOYE WARD",
  "VILLAGES": "02 BUGOYE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "12 BUGOYE WARD",
  "VILLAGES": "05 BUNYAMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "12 BUGOYE WARD",
  "VILLAGES": "06 KABIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "12 BUGOYE WARD",
  "VILLAGES": "10 LWETEEGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "12 BUGOYE WARD",
  "VILLAGES": "11 MIREMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "01 BULIJJO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "02 BUNYIRI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "03 KALAGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "04 KASOZI  A"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "05 KASOZI  B"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "06 KIKAABYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "07 KITANDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "08 NAALYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "09 NABIYAGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "10 NAMMERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "12 BULIJJO",
  "VILLAGES": "11 NKONGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "12 KYAJJA",
  "VILLAGES": "01 BUBIRO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "12 KYAJJA",
  "VILLAGES": "02 BUKUKU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "12 KYAJJA",
  "VILLAGES": "03 BULANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "12 KYAJJA",
  "VILLAGES": "04 KIWALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "12 KYAJJA",
  "VILLAGES": "05 KYAJJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "12 KYAJJA",
  "VILLAGES": "06 NAMANYAMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "13 BUNAKIJJA WARD",
  "VILLAGES": "01 BUNAKIJJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "13 BUNAKIJJA WARD",
  "VILLAGES": "02 GOLOMOLO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "13 BUNAKIJJA WARD",
  "VILLAGES": "05 LUGOBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "01 KABEMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "02 KALEBERA 'A'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "03 KALEBERA 'B'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "04 KATEETE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "05 KATEGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "06 KIKANDWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "07 KIMOTE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "08 KIYUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "09 LUGAMBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "10 MBALIGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "11 MIGGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "13 KABEMBE",
  "VILLAGES": "12 NAMIREMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "01 KALAGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "02 KAWUTUTU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "03 MAGADA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "04 MAYANGAYANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "05 NAGOJJE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "06 NAKASEETA II"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "07 NAMIREMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "08 NATYOLE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "13 NAGOJJE",
  "VILLAGES": "09 NDEEBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "14 KABANGA",
  "VILLAGES": "02 BUTERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "14 KABANGA",
  "VILLAGES": "05 GOBERO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "14 KABANGA",
  "VILLAGES": "06 KABANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "14 KABANGA",
  "VILLAGES": "11 SSUGU - LUGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "01 BULIMU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "02 KAKOOLA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "03 KALAGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "04 KASALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "05 KYABAKADDE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "06 KYAMPISI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "07 NAMANGANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "08 NAMMENGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "14 KYABAKADDE",
  "VILLAGES": "09 NKONGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "14 NAKIBANO",
  "VILLAGES": "01 KASANA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "14 NAKIBANO",
  "VILLAGES": "02 KASOKOSO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "14 NAKIBANO",
  "VILLAGES": "03 KYETUME I"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "14 NAKIBANO",
  "VILLAGES": "04 KYETUME II"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "14 NAKIBANO",
  "VILLAGES": "05 MANGIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "14 NAKIBANO",
  "VILLAGES": "06 NAMASINDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "14 NAKIBANO",
  "VILLAGES": "07 NANFUMBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "14 NAKIBANO",
  "VILLAGES": "08 WABULONGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "01 BAMUTAKUDDE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "02 BUNTABA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "03 DDUNDU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "04 KALAGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "05 KASAAYI  A"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "06 KASAAYI  B"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "07 KIRYAMULI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "08 KYOGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "09 MUSOMBWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "10 NAKASAJJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "11 NAKUMBO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "12 NAMULABA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "15 DDUNDU",
  "VILLAGES": "13 NAKKOBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "15 MPATTA",
  "VILLAGES": "02 BUKULE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "15 MPATTA",
  "VILLAGES": "05 MPATTA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "15 MPATTA",
  "VILLAGES": "08 NTUNDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "15 NAMATABA  A WARD",
  "VILLAGES": "01 GALABI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "15 NAMATABA  A WARD",
  "VILLAGES": "02 BULAAYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "15 NAMATABA  A WARD",
  "VILLAGES": "04 KIBAATI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "15 NAMATABA  A WARD",
  "VILLAGES": "05 KYAWANVUBU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "15 NAMATABA  A WARD",
  "VILLAGES": "06 MUTTANZIGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "15 NAMATABA  A WARD",
  "VILLAGES": "08 NAMATABA CENTRAL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "15 NAMATABA  A WARD",
  "VILLAGES": "09 WANTAAYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "16 MPUNGE",
  "VILLAGES": "02 BUSOKE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "16 MPUNGE",
  "VILLAGES": "06 KIKEERA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "16 MPUNGE",
  "VILLAGES": "08 KIRUDDU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "16 MPUNGE",
  "VILLAGES": "11 MASUJJU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "16 MPUNGE",
  "VILLAGES": "14 MENGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "16 MPUNGE",
  "VILLAGES": "15 MPUNGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "01 KASANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "02 KASENENE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "03 KONERO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "04 KWAABA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "05 LUGUZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "06 LUSANJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "07 MULUNGIOMU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "08 NAKUMBO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "09 NAMASUMBI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "10 NATEETE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KYAMPISI",
  "PARISH": "16 NTONTO",
  "VILLAGES": "11 NTONTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "01 KASAALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "02 KASININYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "04 KISOOBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "05 KITTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "06 KYEGALASO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "07 LUNNYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "08 MASIKO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "09 WAGGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAGOJJE",
  "PARISH": "16 WAGGALA",
  "VILLAGES": "10 WASSWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "17 BUKASA",
  "VILLAGES": "01 BUKASA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "17 BUKASA",
  "VILLAGES": "02 KAWUKU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "17 BUKASA",
  "VILLAGES": "03 KISOGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "17 BUKASA",
  "VILLAGES": "04 NAJJA-KIREKU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "17 BUKASA",
  "VILLAGES": "05 NAMAKOMO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "17 NSANJA WARD",
  "VILLAGES": "03 GONVE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "17 NSANJA WARD",
  "VILLAGES": "08 KIKUUTA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "17 NSANJA WARD",
  "VILLAGES": "10 NSANJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "01 BUTEBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "02 D.F.I."
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "03 INDUSTRIAL AREA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "04 LOWER KAUGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "05 MULAGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "06 NAKABAGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "07 NASUUTI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "08 NSAMBWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "17 NTAWO WARD",
  "VILLAGES": "09 NTAWO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "18 KAWONGO",
  "VILLAGES": "01 KAMIRA - BUKONERO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "18 KAWONGO",
  "VILLAGES": "02 KAWONGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "18 KAWONGO",
  "VILLAGES": "03 MAYANGAYANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "18 KAWONGO",
  "VILLAGES": "04 NAKIBANO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "18 KAWONGO",
  "VILLAGES": "05 WABUSANKE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "18 KAWONGO",
  "VILLAGES": "06 WANJEYO - KALAGALA -  KITO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "18 KAWONGO",
  "VILLAGES": "07 KISAMBA - KIRINYABIGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "01 ANTHONY"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "02 BASIIMA-KIKOOZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "03 CENTRAL NABUTI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "04 DDANDIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "05 GUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "06 KAVULE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "07 KIGOMBYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "08 KITEGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "09 LOWER - NABUTI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "10 LWEZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "11 NAMUMIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "18 NAMUMIRA\/ANTHONY WARD",
  "VILLAGES": "12 NSUUBE 'A'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "18 NTENJERU-NTANZI WARD",
  "VILLAGES": "01 BUGOLOMBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "18 NTENJERU-NTANZI WARD",
  "VILLAGES": "08 KIWAFU TEA ESTATE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "18 NTENJERU-NTANZI WARD",
  "VILLAGES": "11 NAMATABA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "18 NTENJERU-NTANZI WARD",
  "VILLAGES": "12 NTANZI\/MBAJJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "18 NTENJERU-NTANZI WARD",
  "VILLAGES": "13 NTENJERU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "18 NTENJERU-NTANZI WARD",
  "VILLAGES": "14 NSUMBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "01 AGIP"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "02 COLLINE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "03 GGULU 'A'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "04 HAMU-MUKASA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "05 KASANGALABI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "06 KIGOMBYA NORTH"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "07 KIRANGIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "08 KITETE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "09 NGANDU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "10 SSAZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "03 MUKONO CENTRAL DIVISION",
  "PARISH": "19 GGULU WARD",
  "VILLAGES": "11 TOTAL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "19 KIWAFU",
  "VILLAGES": "01 JUMBA - GENDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "19 KIWAFU",
  "VILLAGES": "02 KIMENYEDDE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "19 KIWAFU",
  "VILLAGES": "03 KIWAFU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "19 KIWAFU",
  "VILLAGES": "05 MAGONGA - ZIRANSO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "19 KIWAFU",
  "VILLAGES": "06 NABUKUKU - LUBANJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "19 KIWAFU",
  "VILLAGES": "07 NABULOOTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "19 KIWAFU",
  "VILLAGES": "08 ZIGULU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "19 SSAAYI WARD",
  "VILLAGES": "01 KALAGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "19 SSAAYI WARD",
  "VILLAGES": "02 KAZO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "19 SSAAYI WARD",
  "VILLAGES": "03 KITUUZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "19 SSAAYI WARD",
  "VILLAGES": "07 NAKASUKU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "19 SSAAYI WARD",
  "VILLAGES": "08 NAKIBANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "19 SSAAYI WARD",
  "VILLAGES": "09 NTUMUSI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "19 SSAAYI WARD",
  "VILLAGES": "10 SSAAYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "20 NAKIFUMA WARD",
  "VILLAGES": "03 KAAMA -  KAGANJO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "20 NAKIFUMA WARD",
  "VILLAGES": "04 KIZUNGU ZONE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "20 NAKIFUMA WARD",
  "VILLAGES": "05 NAKIFUMA EAST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "20 NAKIFUMA WARD",
  "VILLAGES": "06 NAKIFUMA WEST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "20 NAMAWOJJOLO",
  "VILLAGES": "01 BULIGOBE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "20 NAMAWOJJOLO",
  "VILLAGES": "02 BWEFULUMYA EAST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "20 NAMAWOJJOLO",
  "VILLAGES": "03 NAMAWOJJOLO EAST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "20 NAMAWOJJOLO",
  "VILLAGES": "04 NAMAWOJJOLO WEST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "20 NAMAWOJJOLO",
  "VILLAGES": "05 WALUSUBI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "20 NAMAWOJJOLO",
  "VILLAGES": "06 WANJEYO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 NAMA",
  "PARISH": "20 NAMAWOJJOLO",
  "VILLAGES": "07 BWEFULUMYA WEST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "20 TERERE WARD",
  "VILLAGES": "01 BUNANKANDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "20 TERERE WARD",
  "VILLAGES": "02 BUTININDI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "20 TERERE WARD",
  "VILLAGES": "03 TERERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "21 KYETUME",
  "VILLAGES": "01 BUKASA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "21 KYETUME",
  "VILLAGES": "02 KAZINGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "21 KYETUME",
  "VILLAGES": "03 KYETUME"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "21 KYETUME",
  "VILLAGES": "04 LUFUNVE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 NAKISUNGA",
  "PARISH": "21 KYETUME",
  "VILLAGES": "05 NTALE-KYEYO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "21 NANGA",
  "VILLAGES": "01 GALIGATYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "21 NANGA",
  "VILLAGES": "02 GIRINYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "21 NANGA",
  "VILLAGES": "03 KAKAKALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "21 NANGA",
  "VILLAGES": "04 KIBIRIBIRI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "21 NANGA",
  "VILLAGES": "05 KITUBA - NABIBUGGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "21 NANGA",
  "VILLAGES": "06 KIYIRIBWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "21 NANGA",
  "VILLAGES": "07 NANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "02 KIMENYEDDE",
  "PARISH": "21 NANGA",
  "VILLAGES": "08 NDWADDEMUTWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "22 KATEETE",
  "VILLAGES": "01 KALAGALA\/NAMUGONGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "22 KATEETE",
  "VILLAGES": "02 KATEETE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "22 LULAGWE",
  "VILLAGES": "01 KIZIRU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "22 LULAGWE",
  "VILLAGES": "09 KYAZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "22 LULAGWE",
  "VILLAGES": "10 LULAGWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "22 LULAGWE",
  "VILLAGES": "16 MUVO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "23 KYABAZAALA",
  "VILLAGES": "01 BULYANTI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "23 KYABAZAALA",
  "VILLAGES": "02 KAWUKU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "23 KYABAZAALA",
  "VILLAGES": "03 KITEREDDE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "23 KYABAZAALA",
  "VILLAGES": "04 KYABAZAALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "23 MBAZI",
  "VILLAGES": "01 BULEEBI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "23 MBAZI",
  "VILLAGES": "05 KAMWANYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "23 MBAZI",
  "VILLAGES": "13 MBAZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "23 MBAZI",
  "VILLAGES": "18 SANGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "24 NAMAYUBA",
  "VILLAGES": "01 KIKOMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "24 NAMAYUBA",
  "VILLAGES": "02 NAMAYUBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "24 NAMAYUBA",
  "VILLAGES": "03 NTONTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "24 NAMAYUBA",
  "VILLAGES": "04 WALUBIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "24 NGOMBERE",
  "VILLAGES": "03 BUWUJJA-MBEYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "24 NGOMBERE",
  "VILLAGES": "04 KAGULU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "24 NGOMBERE",
  "VILLAGES": "07 KIKUBO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "24 NGOMBERE",
  "VILLAGES": "12 MBALE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "04 MPUNGE",
  "PARISH": "24 NGOMBERE",
  "VILLAGES": "17 NGOMBERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "25 KIYANJA",
  "VILLAGES": "01 BANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "25 KIYANJA",
  "VILLAGES": "03 BULIKAASA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "25 KIYANJA",
  "VILLAGES": "07 KAWUNA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "25 KIYANJA",
  "VILLAGES": "09 KIYANJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "25 NTUNDA",
  "VILLAGES": "01 BUYOVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "25 NTUNDA",
  "VILLAGES": "02 KITAYUNJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "25 NTUNDA",
  "VILLAGES": "03 NAMUKUPA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "25 NTUNDA",
  "VILLAGES": "04 NAMULABA\/KITO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 NTUNDA",
  "PARISH": "25 NTUNDA",
  "VILLAGES": "05 NTUNDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "01 BWEGIIRE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "02 KAKUKUULU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "03 KAYINI  I"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "04 KAYINI  II"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "05 KIKOMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "06 KIKONDO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "07 KIMEGGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "08 LUGUJE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "26 KAYINI",
  "VILLAGES": "09 NAKYEEKE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "26 MUBANDA",
  "VILLAGES": "01 BUSOKE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "26 MUBANDA",
  "VILLAGES": "03 BULE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "26 MUBANDA",
  "VILLAGES": "07 KISINSI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "26 MUBANDA",
  "VILLAGES": "10 MUBANDA-LWEZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "27 KITALE",
  "VILLAGES": "01 BUTWALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "27 KITALE",
  "VILLAGES": "02 KAKOOGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "27 KITALE",
  "VILLAGES": "03 KASIISO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "27 KITALE",
  "VILLAGES": "04 KATUUSO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "27 KITALE",
  "VILLAGES": "08 LUSERA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "27 KITALE",
  "VILLAGES": "09 MAGGWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "27 KITALE",
  "VILLAGES": "10 NAKASENYI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "27 MUGOMBA",
  "VILLAGES": "01 BUGIGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "27 MUGOMBA",
  "VILLAGES": "06 MUGOMBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "27 MUGOMBA",
  "VILLAGES": "09 SSOZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "28 KITUULA",
  "VILLAGES": "01 GIIMBI I"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "28 KITUULA",
  "VILLAGES": "02 GIIMBI II"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "28 KITUULA",
  "VILLAGES": "03 KITUULA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "28 KITUULA",
  "VILLAGES": "04 KYANIKA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "28 KITUULA",
  "VILLAGES": "06 LUGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "28 KITUULA",
  "VILLAGES": "07 MBULAMUTI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "28 NAKALANDA",
  "VILLAGES": "03 BUYUNJU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "28 NAKALANDA",
  "VILLAGES": "04 MAWOTTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "28 NAKALANDA",
  "VILLAGES": "07 NAKALANDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "01 BUTUMBIIRI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "02 KABUMBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "03 KAKAKALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "04 KIBBUYE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "05 KYAMBOGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "06 NABIGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "07 NAMUGANGA EAST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "08 NAMUGANGA WEST"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "09 NSAGI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "29 NAMUGANGA",
  "VILLAGES": "10 NTONTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "29 TTABA",
  "VILLAGES": "01 BWANIKA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "29 TTABA",
  "VILLAGES": "04 BUWUNGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "29 TTABA",
  "VILLAGES": "09 MPENJA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 MPATTA",
  "PARISH": "29 TTABA",
  "VILLAGES": "12 TTABA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "30 KALENGERA WARD",
  "VILLAGES": "01 BUGONGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "30 KALENGERA WARD",
  "VILLAGES": "04 KALENGERA A"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "30 KALENGERA WARD",
  "VILLAGES": "05 KALENGERA B"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "30 KALENGERA WARD",
  "VILLAGES": "07 KIKOONA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "01 BULONGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "02 BUYITA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "03 KAWEERI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "04 MAKENKE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "05 MAWOTTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "06 NAKADDINDIRI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "07 NAKASEJJERE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "08 NAMANOGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "09 NJALAALWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "10 NSAABWA  A"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "11 NSAABWA  B"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "05 NAMUGANGA",
  "PARISH": "30 NAMANOGA",
  "VILLAGES": "12 SEETA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "31 KATOSI WARD",
  "VILLAGES": "02 BWANGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "31 KATOSI WARD",
  "VILLAGES": "06 KATOSI CENTRAL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "31 KATOSI WARD",
  "VILLAGES": "09 KIZAALA BUGANDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "31 NAMAGUNGA WARD",
  "VILLAGES": "01 KAYANJA B"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "31 NAMAGUNGA WARD",
  "VILLAGES": "02 KAYANJA A"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "31 NAMAGUNGA WARD",
  "VILLAGES": "03 KAYANJA C"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "31 NAMAGUNGA WARD",
  "VILLAGES": "06 NAMAGUNGA A"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "31 NAMAGUNGA WARD",
  "VILLAGES": "07 NAMAGUNGA B"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "31 NAMAGUNGA WARD",
  "VILLAGES": "08 NAMAGUNGA C"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "32 KABIMBIRI B WARD",
  "VILLAGES": "01 KABIMBIRI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "32 KABIMBIRI B WARD",
  "VILLAGES": "05 KIKANDWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "32 KABIMBIRI B WARD",
  "VILLAGES": "11 KIGGAGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "32 LUGAZI WARD",
  "VILLAGES": "03 KULUBBI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "06 KATOSI TOWN COUNCIL",
  "PARISH": "32 LUGAZI WARD",
  "VILLAGES": "04 LUGAZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "33 KASENGE WARD",
  "VILLAGES": "01 KIGAYAZA II"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "33 KASENGE WARD",
  "VILLAGES": "02 KASENGE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "33 KASENGE WARD",
  "VILLAGES": "04 KITOVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "33 MAZIBA WARD",
  "VILLAGES": "04 LUUTE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "33 MAZIBA WARD",
  "VILLAGES": "05 MAVUNIKIRE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "33 MAZIBA WARD",
  "VILLAGES": "06 MAZIBA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "34 KITALE WARD",
  "VILLAGES": "04 KITALE  BUSIA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "34 KITALE WARD",
  "VILLAGES": "05 KYEWANISE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "34 KITALE WARD",
  "VILLAGES": "06 KITALE 'A'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "34 KITALE WARD",
  "VILLAGES": "07 KITALE 'B'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "34 MPUMU WARD",
  "VILLAGES": "06 LUBERENGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "34 MPUMU WARD",
  "VILLAGES": "07 LUGA-KAZINGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "34 MPUMU WARD",
  "VILLAGES": "08 LUGGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "34 MPUMU WARD",
  "VILLAGES": "09 MPOLOGOMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "34 MPUMU WARD",
  "VILLAGES": "10 MPUMU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "35 KASAWO WARD",
  "VILLAGES": "01 KASAWO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "35 KASAWO WARD",
  "VILLAGES": "03 KITEGULA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "07 KASAWO TOWN COUNCIL",
  "PARISH": "35 KASAWO WARD",
  "VILLAGES": "06 MUBANDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "35 KISOGA WARD",
  "VILLAGES": "02 KISOGA 'A'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "35 KISOGA WARD",
  "VILLAGES": "03 KISOGA 'B'"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "35 KISOGA WARD",
  "VILLAGES": "04 KISOGA CENTRAL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NTENJERU-KISOGA TOWN COUNCIL",
  "PARISH": "35 KISOGA WARD",
  "VILLAGES": "05 KITO-KIGANDA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "37 BANDAALI WARD",
  "VILLAGES": "01 BUSENYA - NYWEDDEMALWA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "37 BANDAALI WARD",
  "VILLAGES": "02 DDIIKWE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "37 BANDAALI WARD",
  "VILLAGES": "07 NAMALIGA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "37 BANDAALI WARD",
  "VILLAGES": "08 NEKOYEDDE -  GAYAZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "37 BANDAALI WARD",
  "VILLAGES": "09 BANDAALI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "37 BANDAALI WARD",
  "VILLAGES": "10 NAMYOYA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "38 BUBIRO WARD",
  "VILLAGES": "01 BUBIRO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "38 BUBIRO WARD",
  "VILLAGES": "09 NAKIWATE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "39 KIGAGA-JOMAYI WARD",
  "VILLAGES": "02 KAKINZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "39 KIGAGA-JOMAYI WARD",
  "VILLAGES": "03 BUZIRANDULU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "39 KIGAGA-JOMAYI WARD",
  "VILLAGES": "07 KYANKIMA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "39 KIGAGA-JOMAYI WARD",
  "VILLAGES": "11 NENYODDE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "41 NAGGALAMA B WARD",
  "VILLAGES": "06 LUTENGO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "41 NAGGALAMA B WARD",
  "VILLAGES": "07 NAGGALAMA  MISSION"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "41 NAGGALAMA B WARD",
  "VILLAGES": "08 NAGGALAMA  PROFESSIONAL"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "41 NAGGALAMA B WARD",
  "VILLAGES": "09 NAGGALAMA TOWN"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "42 NAKANYONYI-NABBALE WARD",
  "VILLAGES": "02 BUKOOZA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "42 NAKANYONYI-NABBALE WARD",
  "VILLAGES": "04 KIJJO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "42 NAKANYONYI-NABBALE WARD",
  "VILLAGES": "05 KITTO"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "42 NAKANYONYI-NABBALE WARD",
  "VILLAGES": "06 LUKYAAMU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "42 NAKANYONYI-NABBALE WARD",
  "VILLAGES": "07 NAKANYONYI-KIRANGIRA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "08 NAKIFUMA-NAGGALAMA TOWN COUNCIL",
  "PARISH": "42 NAKANYONYI-NABBALE WARD",
  "VILLAGES": "08 NAKANYONYI MISSION LAND"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "43 NAMAGUNGA ANNEX WARD",
  "VILLAGES": "01 KALAGALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "43 NAMAGUNGA ANNEX WARD",
  "VILLAGES": "02 KASOZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "43 NAMAGUNGA ANNEX WARD",
  "VILLAGES": "03 KIKUUTA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "43 NAMAGUNGA ANNEX WARD",
  "VILLAGES": "04 MONEKO-KASANVU"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "43 NAMAGUNGA ANNEX WARD",
  "VILLAGES": "05 NAKAWALA"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "44 NAMATABA B WARD",
  "VILLAGES": "01 NAKALASA TEA ESTATE"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "44 NAMATABA B WARD",
  "VILLAGES": "02 KANYOGOGA - CAMP"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "44 NAMATABA B WARD",
  "VILLAGES": "03 KANYOGOGA - KAAZI"
 },
 {
  "DISTRICT\/CITY": "MUKONO",
  "SUBCOUNTY": "09 NAMATABA TOWN COUNCIL",
  "PARISH": "44 NAMATABA B WARD",
  "VILLAGES": "07 NAKASEETA I"
 }
    ];
    
    // Extract unique values from the geographical data
    const districts = [...new Set(geographicalData.map(item => item["DISTRICT/CITY"]))];
    
    // Function to get subcounties for a district
    function getSubcountiesForDistrict(district) {
        return [...new Set(geographicalData
            .filter(item => item["DISTRICT/CITY"] === district)
            .map(item => item.SUBCOUNTY)
            .sort())];
    }
    
    // Function to get parishes for a subcounty
    function getParishesForSubcounty(district, subcounty) {
        return [...new Set(geographicalData
            .filter(item => item["DISTRICT/CITY"] === district && item.SUBCOUNTY === subcounty)
            .map(item => item.PARISH)
            .sort())];
    }
    
    // Function to get villages for a parish
    function getVillagesForParish(district, subcounty, parish) {
        return [...new Set(geographicalData
            .filter(item => item["DISTRICT/CITY"] === district && 
                           item.SUBCOUNTY === subcounty && 
                           item.PARISH === parish)
            .map(item => item.VILLAGES)
            .sort())];
    }
    
    // ==============================================
    // GEOGRAPHICAL DATA DROPDOWN FUNCTIONS
    // ==============================================
    function initializeGeographicalDropdowns() {
        const districtSelect = document.getElementById('districtCity');
        const subcountySelect = document.getElementById('subcounty');
        const parishSelect = document.getElementById('parish');
        const villageSelect = document.getElementById('village');
        
        // Clear existing options
        districtSelect.innerHTML = '<option value="">Select District/City</option>';
        subcountySelect.innerHTML = '<option value="">Select Subcounty</option>';
        parishSelect.innerHTML = '<option value="">Select Parish</option>';
        villageSelect.innerHTML = '<option value="">Select Village</option>';
        
        // Populate districts
        districts.forEach(district => {
            const option = document.createElement('option');
            option.value = district;
            option.textContent = district;
            districtSelect.appendChild(option);
        });
        
        // Disable dependent dropdowns initially
        subcountySelect.disabled = true;
        parishSelect.disabled = true;
        villageSelect.disabled = true;
    }
    
    function updateSubcounties() {
        const districtSelect = document.getElementById('districtCity');
        const subcountySelect = document.getElementById('subcounty');
        const parishSelect = document.getElementById('parish');
        const villageSelect = document.getElementById('village');
        
        const selectedDistrict = districtSelect.value;
        
        if (!selectedDistrict) {
            subcountySelect.disabled = true;
            parishSelect.disabled = true;
            villageSelect.disabled = true;
            
            subcountySelect.innerHTML = '<option value="">Select Subcounty</option>';
            parishSelect.innerHTML = '<option value="">Select Parish</option>';
            villageSelect.innerHTML = '<option value="">Select Village</option>';
            return;
        }
        
        // Enable subcounty dropdown
        subcountySelect.disabled = false;
        
        // Clear and populate subcounties
        subcountySelect.innerHTML = '<option value="">Select Subcounty</option>';
        const subcounties = getSubcountiesForDistrict(selectedDistrict);
        
        subcounties.forEach(subcounty => {
            const option = document.createElement('option');
            option.value = subcounty;
            option.textContent = subcounty;
            subcountySelect.appendChild(option);
        });
        
        // Clear parish and village dropdowns
        parishSelect.disabled = true;
        villageSelect.disabled = true;
        parishSelect.innerHTML = '<option value="">Select Parish</option>';
        villageSelect.innerHTML = '<option value="">Select Village</option>';
    }
    
    function updateParishes() {
        const districtSelect = document.getElementById('districtCity');
        const subcountySelect = document.getElementById('subcounty');
        const parishSelect = document.getElementById('parish');
        const villageSelect = document.getElementById('village');
        
        const selectedDistrict = districtSelect.value;
        const selectedSubcounty = subcountySelect.value;
        
        if (!selectedDistrict || !selectedSubcounty) {
            parishSelect.disabled = true;
            villageSelect.disabled = true;
            
            parishSelect.innerHTML = '<option value="">Select Parish</option>';
            villageSelect.innerHTML = '<option value="">Select Village</option>';
            return;
        }
        
        // Enable parish dropdown
        parishSelect.disabled = false;
        
        // Clear and populate parishes
        parishSelect.innerHTML = '<option value="">Select Parish</option>';
        const parishes = getParishesForSubcounty(selectedDistrict, selectedSubcounty);
        
        parishes.forEach(parish => {
            const option = document.createElement('option');
            option.value = parish;
            option.textContent = parish;
            parishSelect.appendChild(option);
        });
        
        // Clear village dropdown
        villageSelect.disabled = true;
        villageSelect.innerHTML = '<option value="">Select Village</option>';
    }
    
    function updateVillages() {
        const districtSelect = document.getElementById('districtCity');
        const subcountySelect = document.getElementById('subcounty');
        const parishSelect = document.getElementById('parish');
        const villageSelect = document.getElementById('village');
        
        const selectedDistrict = districtSelect.value;
        const selectedSubcounty = subcountySelect.value;
        const selectedParish = parishSelect.value;
        
        if (!selectedDistrict || !selectedSubcounty || !selectedParish) {
            villageSelect.disabled = true;
            villageSelect.innerHTML = '<option value="">Select Village</option>';
            return;
        }
        
        // Enable village dropdown
        villageSelect.disabled = false;
        
        // Clear and populate villages
        villageSelect.innerHTML = '<option value="">Select Village</option>';
        const villages = getVillagesForParish(selectedDistrict, selectedSubcounty, selectedParish);
        
        villages.forEach(village => {
            const option = document.createElement('option');
            option.value = village;
            option.textContent = village;
            villageSelect.appendChild(option);
        });
    }

    // ==============================================
    // REGISTRATION TYPE FUNCTIONS
    // ==============================================
    function setRegistrationType(type) {
        registrationType = type;
        
        // Update toggle buttons
        document.getElementById('titledToggle').classList.toggle('active', type === 'titled');
        document.getElementById('untitledToggle').classList.toggle('active', type === 'untitled');
        
        // Enable/disable title fields
        const titleFields = document.getElementById('titleFields');
        const plotNumberInput = document.getElementById('plotNumber');
        const blockNumberInput = document.getElementById('blockNumber');
        
        if (type === 'titled') {
            titleFields.style.display = 'grid';
            plotNumberInput.disabled = false;
            blockNumberInput.disabled = false;
            plotNumberInput.required = true;
            blockNumberInput.required = true;
        } else {
            titleFields.style.display = 'none';
            plotNumberInput.disabled = true;
            blockNumberInput.disabled = true;
            plotNumberInput.required = false;
            blockNumberInput.required = false;
            plotNumberInput.value = '';
            blockNumberInput.value = '';
        }
        
        logger.addLogEntry(`Registration type set to: ${type}`, "info");
    }
    
    // ==============================================
    // MANUAL ENTRY TOGGLE FUNCTIONS
    // ==============================================
    function toggleManualEntry(fieldType) {
        const selectElement = document.getElementById(fieldType);
        const manualInput = document.getElementById(fieldType + 'Manual');
        
        if (selectElement.style.display === 'none') {
            // Switch back to dropdown
            selectElement.style.display = 'block';
            manualInput.style.display = 'none';
            selectElement.disabled = false;
            
            // Clear manual input
            manualInput.value = '';
            
            // Update dependent dropdowns
            if (fieldType === 'districtCity') {
                updateSubcounties();
            } else if (fieldType === 'subcounty') {
                updateParishes();
            } else if (fieldType === 'parish') {
                updateVillages();
            }
        } else {
            // Switch to manual input
            selectElement.style.display = 'none';
            manualInput.style.display = 'block';
            selectElement.disabled = true;
            
            // Clear dropdown selection
            selectElement.value = '';
            
            // Update dependent dropdowns
            if (fieldType === 'districtCity') {
                document.getElementById('subcounty').disabled = true;
                document.getElementById('subcounty').value = '';
                document.getElementById('parish').disabled = true;
                document.getElementById('parish').value = '';
                document.getElementById('village').disabled = true;
                document.getElementById('village').value = '';
            } else if (fieldType === 'subcounty') {
                document.getElementById('parish').disabled = true;
                document.getElementById('parish').value = '';
                document.getElementById('village').disabled = true;
                document.getElementById('village').value = '';
            } else if (fieldType === 'parish') {
                document.getElementById('village').disabled = true;
                document.getElementById('village').value = '';
            }
        }
    }
    
    // ==============================================
    // PROPERTY ID GENERATION
    // ==============================================
    function generatePropertyId() {
        // Get the highest property ID from existing records
        const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
        let maxId = 0;
        
        db.forEach(record => {
            // Extract numeric part from Property ID (assuming format like PRO-001, PRO-123, etc.)
            const idMatch = record.propertyId.match(/PRO-(\d+)/);
            if (idMatch) {
                const idNum = parseInt(idMatch[1]);
                if (idNum > maxId) {
                    maxId = idNum;
                }
            }
        });
        
        // Start from maxId + 1, or 1 if no records exist
        propertyIdCounter = maxId + 1;
        
        // Generate new ID
        const newId = `PRO-${propertyIdCounter.toString().padStart(3, '0')}`;
        document.getElementById('propertyId').value = newId;
        propertyIdCounter++;
    }

    // ==============================================
    // FIREBASE DATA MANAGER
    // ==============================================
    class FirebaseDataManager {
        constructor() {
            if (!firebaseApp) {
                console.error('Firebase not initialized');
                return;
            }
            
            this.db = firebaseDb;
            this.auth = firebaseAuth;
            this.userId = null;
            this.userEmail = null;
            this.isOnline = navigator.onLine;
            this.syncQueue = [];
            this.isSyncing = false;
            this.lastSyncTime = null;
            
            // Set up auth state listener
            this.setupAuthListener();
            
            // Set up network status listener
            this.setupNetworkListener();
            
            // Initialize offline queue
            this.loadSyncQueue();
            
            // Start periodic sync
            this.startPeriodicSync();
        }
        
        setupAuthListener() {
            this.auth.onAuthStateChanged((user) => {
                if (user) {
                    this.userId = user.uid;
                    this.userEmail = user.email;
                    console.log('Firebase: User authenticated:', user.email);
                    
                    // Update UI
                    this.updateFirebaseStatus(true);
                    
                    // Start syncing any queued data
                    this.processSyncQueue();
                    
                    // Update sync stats
                    this.updateSyncStats();
                } else {
                    this.userId = null;
                    this.userEmail = null;
                    console.log('Firebase: User signed out');
                    this.updateFirebaseStatus(false);
                }
            });
        }
        
        setupNetworkListener() {
            window.addEventListener('online', () => {
                this.isOnline = true;
                console.log('Firebase: Back online, starting sync');
                this.updateFirebaseStatus(this.userId !== null);
                this.processSyncQueue();
            });
            
            window.addEventListener('offline', () => {
                this.isOnline = false;
                console.log('Firebase: Offline mode');
                this.updateFirebaseStatus(false);
            });
        }
        
        loadSyncQueue() {
            const queue = localStorage.getItem('lavmis_sync_queue');
            if (queue) {
                this.syncQueue = JSON.parse(queue);
            }
        }
        
        saveSyncQueue() {
            localStorage.setItem('lavmis_sync_queue', JSON.stringify(this.syncQueue));
        }
        
        updateFirebaseStatus(isConnected) {
            const statusPanel = document.getElementById('firebaseStatusPanel');
            const statusIndicator = document.getElementById('firebase-status-ind');
            const statusElement = document.getElementById('firebaseConnectionStatus');
            const statusText = document.getElementById('firebaseStatusText');
            const statusDetail = document.getElementById('firebaseStatusDetail');
            const syncInfo = document.getElementById('syncStatusInfo');
            
            if (isConnected && this.userId) {
                statusPanel.style.display = 'block';
                statusIndicator.style.display = 'flex';
                statusIndicator.innerHTML = '<i class="fa-solid fa-cloud"></i> FIREBASE';
                
                if (this.isOnline) {
                    statusElement.className = 'firebase-status online';
                    statusElement.innerHTML = `
                        <i class="fa-solid fa-cloud-check"></i>
                        <div style="flex-grow: 1;">
                            <div style="font-weight: 600; font-size: 0.9rem;">Connected to Firebase</div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary);">
                                User: ${this.userEmail}
                            </div>
                        </div>
                    `;
                    
                    if (syncInfo) {
                        syncInfo.style.display = 'flex';
                        syncInfo.className = 'firebase-status online';
                        syncInfo.innerHTML = `
                            <i class="fa-solid fa-cloud-check"></i>
                            <div style="flex-grow: 1;">
                                <div style="font-weight: 600; font-size: 0.9rem;">Cloud Sync Active</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">
                                    Real-time cloud synchronization enabled
                                </div>
                            </div>
                        `;
                    }
                } else {
                    statusElement.className = 'firebase-status offline';
                    statusElement.innerHTML = `
                        <i class="fa-solid fa-cloud-slash"></i>
                        <div style="flex-grow: 1;">
                            <div style="font-weight: 600; font-size: 0.9rem;">Offline Mode</div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary);">
                                Changes will sync when back online
                            </div>
                        </div>
                    `;
                    
                    if (syncInfo) {
                        syncInfo.style.display = 'flex';
                        syncInfo.className = 'firebase-status offline';
                        syncInfo.innerHTML = `
                            <i class="fa-solid fa-cloud-slash"></i>
                            <div style="flex-grow: 1;">
                                <div style="font-weight: 600; font-size: 0.9rem;">Working Offline</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">
                                    Data queued for sync (${this.syncQueue.length} items)
                                </div>
                            </div>
                        `;
                    }
                }
            } else {
                statusPanel.style.display = 'none';
                statusIndicator.style.display = 'none';
                
                if (syncInfo) {
                    syncInfo.style.display = 'none';
                }
            }
        }
        
        async savePropertyToFirebase(propertyData) {
            if (!this.userId) {
                throw new Error('User not authenticated. Please log in again.');
            }
            
            const firebaseRecord = {
                ...propertyData,
                userId: this.userId,
                userEmail: this.userEmail,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                syncStatus: 'pending',
                localId: propertyData.id
            };
            
            // Remove the local ID for Firebase
            delete firebaseRecord.id;
            
            if (this.isOnline) {
                try {
                    // Save to Firestore
                    const docRef = await this.db.collection('properties').add(firebaseRecord);
                    console.log('Firebase: Property saved with ID:', docRef.id);
                    
                    // Update local storage with Firebase ID
                    const localRecord = { 
                        ...propertyData, 
                        firebaseId: docRef.id,
                        syncStatus: 'synced',
                        syncedAt: new Date().toISOString()
                    };
                    this.updateLocalStorage(propertyData.id, localRecord);
                    
                    this.showFirebaseNotification('Property saved to Firebase', 'success');
                    
                    return { success: true, firebaseId: docRef.id };
                } catch (error) {
                    console.error('Firebase save error:', error);
                    
                    // Queue for later sync
                    this.addToSyncQueue('create', propertyData);
                    
                    // Update local record with sync status
                    const localRecord = { ...propertyData, syncStatus: 'queued' };
                    this.updateLocalStorage(propertyData.id, localRecord);
                    
                    this.showFirebaseNotification('Property queued for sync (offline)', 'warning');
                    
                    throw error;
                }
            } else {
                // Queue for sync when online
                this.addToSyncQueue('create', propertyData);
                
                // Update local record with sync status
                const localRecord = { ...propertyData, syncStatus: 'queued' };
                this.updateLocalStorage(propertyData.id, localRecord);
                
                this.showFirebaseNotification('Property saved locally (offline mode)', 'info');
                
                return { success: true, message: 'Queued for sync when online' };
            }
        }
        
        addToSyncQueue(operation, data) {
            const queueItem = {
                id: Date.now(),
                operation: operation,
                data: data,
                timestamp: new Date().toISOString(),
                attempts: 0
            };
            
            this.syncQueue.push(queueItem);
            this.saveSyncQueue();
            
            console.log(`Firebase: Added to sync queue (${operation}):`, data.propertyId);
            this.updateSyncStats();
        }
        
        async processSyncQueue() {
            if (!this.isOnline || !this.userId || this.isSyncing || this.syncQueue.length === 0) {
                return;
            }
            
            this.isSyncing = true;
            console.log(`Firebase: Processing ${this.syncQueue.length} queued items`);
            
            const successfulItems = [];
            const failedItems = [];
            
            // Show sync notification
            this.showFirebaseNotification(`Syncing ${this.syncQueue.length} items to Firebase...`, 'info');
            
            for (const item of this.syncQueue) {
                try {
                    if (item.operation === 'create') {
                        const firebaseRecord = {
                            ...item.data,
                            userId: this.userId,
                            userEmail: this.userEmail,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            syncStatus: 'synced',
                            originallyQueuedAt: item.timestamp
                        };
                        
                        delete firebaseRecord.id;
                        
                        const docRef = await this.db.collection('properties').add(firebaseRecord);
                        
                        // Update local storage with Firebase ID
                        const localRecord = { 
                            ...item.data, 
                            firebaseId: docRef.id,
                            syncStatus: 'synced',
                            syncedAt: new Date().toISOString()
                        };
                        this.updateLocalStorage(item.data.id, localRecord);
                        
                        successfulItems.push(item.id);
                        console.log('Firebase: Synced queued property:', item.data.propertyId);
                    }
                } catch (error) {
                    console.error('Firebase sync error for item:', item.id, error);
                    item.attempts++;
                    
                    if (item.attempts < 3) {
                        failedItems.push(item);
                    } else {
                        console.error('Firebase: Failed after 3 attempts:', item.id);
                        // Mark as permanently failed
                        this.markAsFailed(item.data.id);
                    }
                }
            }
            
            // Remove successfully synced items
            this.syncQueue = this.syncQueue.filter(item => 
                !successfulItems.includes(item.id)
            );
            
            // Update failed items (with increased attempt count)
            this.syncQueue = this.syncQueue.map(item => {
                const failed = failedItems.find(f => f.id === item.id);
                return failed ? failed : item;
            });
            
            this.saveSyncQueue();
            this.isSyncing = false;
            this.lastSyncTime = new Date();
            
            // Update UI
            this.updateSyncStats();
            
            if (successfulItems.length > 0) {
                this.showFirebaseNotification(`${successfulItems.length} records synced to Firebase`, 'success');
                updateTable(); // Refresh table to show updated sync status
            }
            
            if (failedItems.length > 0) {
                this.showFirebaseNotification(`${failedItems.length} items failed to sync`, 'error');
            }
        }
        
        updateLocalStorage(localId, updatedRecord) {
            let db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            const index = db.findIndex(item => item.id === localId);
            
            if (index !== -1) {
                db[index] = { ...db[index], ...updatedRecord };
                localStorage.setItem('lavmis_pro_db', JSON.stringify(db));
            }
        }
        
        markAsFailed(localId) {
            let db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            const index = db.findIndex(item => item.id === localId);
            
            if (index !== -1) {
                db[index].syncStatus = 'failed';
                db[index].syncError = 'Failed after 3 attempts';
                localStorage.setItem('lavmis_pro_db', JSON.stringify(db));
            }
        }
        
        updateSyncStats() {
            const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            const syncedCount = db.filter(item => item.syncStatus === 'synced').length;
            const pendingCount = db.filter(item => 
                item.syncStatus === 'pending' || item.syncStatus === 'queued'
            ).length;
            
            document.getElementById('syncedRecords').textContent = syncedCount;
            document.getElementById('pendingSync').textContent = pendingCount;
            
            // Update sync status text
            const syncStatusText = document.getElementById('syncStatusText');
            if (syncStatusText) {
                if (pendingCount > 0) {
                    syncStatusText.innerHTML = `${pendingCount} records pending sync`;
                } else if (syncedCount > 0) {
                    syncStatusText.innerHTML = `All ${syncedCount} records synced`;
                } else {
                    syncStatusText.innerHTML = 'No records to sync';
                }
            }
        }
        
        showFirebaseNotification(message, type = 'info') {
            const notification = document.getElementById('firebaseSyncNotification');
            const messageEl = document.getElementById('firebaseSyncMessage');
            const detailsEl = document.getElementById('firebaseSyncDetails');
            
            if (!notification || !messageEl) return;
            
            // Set message
            messageEl.textContent = message;
            
            // Set details based on type
            switch(type) {
                case 'success':
                    detailsEl.textContent = 'Successfully synchronized with Firebase';
                    notification.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
                    break;
                case 'warning':
                    detailsEl.textContent = 'Will sync when back online';
                    notification.style.background = 'linear-gradient(135deg, #f39c12 0%, #f1c40f 100%)';
                    break;
                case 'error':
                    detailsEl.textContent = 'Sync failed. Will retry later';
                    notification.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                    break;
                default:
                    detailsEl.textContent = 'Syncing data to cloud database';
                    notification.style.background = 'linear-gradient(135deg, var(--firebase) 0%, #F57C00 100%)';
            }
            
            // Show notification
            notification.style.display = 'flex';
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease-out reverse';
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.animation = 'slideUp 0.3s ease-out';
                }, 300);
            }, 3000);
        }
        
        async backupAllToFirebase() {
            if (!this.userId) {
                throw new Error('User not authenticated');
            }
            
            const localDb = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            
            if (localDb.length === 0) {
                return { success: true, message: 'No data to backup' };
            }
            
            // Show progress notification
            this.showFirebaseNotification(`Backing up ${localDb.length} records to Firebase...`, 'info');
            
            const backupRef = this.db.collection('backups').doc();
            const backupData = {
                userId: this.userId,
                userEmail: this.userEmail,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                recordCount: localDb.length,
                data: localDb.map(record => {
                    const { id, firebaseId, ...rest } = record;
                    return rest;
                }),
                backupType: 'full',
                deviceInfo: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    timestamp: new Date().toISOString()
                }
            };
            
            try {
                await backupRef.set(backupData);
                console.log('Firebase: Full backup created:', backupRef.id);
                
                // Update all local records with Firebase IDs
                let syncedCount = 0;
                for (const record of localDb) {
                    if (!record.firebaseId || record.syncStatus !== 'synced') {
                        try {
                            const firebaseRecord = {
                                ...record,
                                userId: this.userId,
                                userEmail: this.userEmail,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                                syncStatus: 'synced',
                                backupId: backupRef.id,
                                localId: record.id
                            };
                            
                            delete firebaseRecord.id;
                            delete firebaseRecord.firebaseId;
                            
                            let docRef;
                            if (record.firebaseId) {
                                // Update existing document
                                docRef = this.db.collection('properties').doc(record.firebaseId);
                                await docRef.update(firebaseRecord);
                            } else {
                                // Create new document
                                docRef = await this.db.collection('properties').add(firebaseRecord);
                            }
                            
                            this.updateLocalStorage(record.id, { 
                                firebaseId: docRef.id,
                                syncStatus: 'synced',
                                syncedAt: new Date().toISOString()
                            });
                            
                            syncedCount++;
                        } catch (error) {
                            console.error('Error syncing individual record:', error);
                            // Mark as queued for retry
                            this.addToSyncQueue('create', record);
                        }
                    } else {
                        syncedCount++;
                    }
                }
                
                this.updateSyncStats();
                this.showFirebaseNotification(`Backup completed: ${syncedCount}/${localDb.length} records synced`, 'success');
                
                return { 
                    success: true, 
                    backupId: backupRef.id,
                    recordCount: localDb.length,
                    syncedCount: syncedCount
                };
            } catch (error) {
                console.error('Firebase backup error:', error);
                this.showFirebaseNotification(`Backup failed: ${error.message}`, 'error');
                throw error;
            }
        }
        
        async restoreFromFirebase() {
            if (!this.userId) {
                throw new Error('User not authenticated');
            }
            
            if (!confirm("This will restore ALL your data from Firebase Cloud. This action will replace any local data. Continue?")) {
                return;
            }
            
            this.showFirebaseNotification('Restoring data from Firebase...', 'info');
            
            try {
                // Get user's properties from Firebase
                const snapshot = await this.db.collection('properties')
                    .where('userId', '==', this.userId)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const restoredData = [];
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    restoredData.push({
                        ...data,
                        firebaseId: doc.id,
                        id: Date.now() + Math.random(), // Generate new local ID
                        syncStatus: 'synced',
                        syncedAt: new Date().toISOString()
                    });
                });
                
                // Save to local storage
                localStorage.setItem('lavmis_pro_db', JSON.stringify(restoredData));
                
                // Clear and replot markers
                savedLayer.clearLayers();
                restoredData.forEach(plotPoint);
                updateTable();
                
                // Update storage display
                if (storageManager) {
                    storageManager.updateStorageDisplay();
                }
                
                this.updateSyncStats();
                this.showFirebaseNotification(`Restored ${restoredData.length} records from Firebase`, 'success');
                
                logger.addLogEntry(`Data restored from Firebase: ${restoredData.length} records`, "success");
                
                return {
                    success: true,
                    recordCount: restoredData.length,
                    data: restoredData
                };
            } catch (error) {
                console.error('Firebase restore error:', error);
                this.showFirebaseNotification(`Restore failed: ${error.message}`, 'error');
                logger.addLogEntry(`Firebase restore failed: ${error.message}`, "error");
                throw error;
            }
        }
        
        async syncAllToFirebase() {
            if (!this.userId) {
                alert('Please log in to sync with Firebase');
                return;
            }
            
            const localDb = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            const unsyncedRecords = localDb.filter(record => 
                !record.syncStatus || record.syncStatus !== 'synced'
            );
            
            if (unsyncedRecords.length === 0) {
                this.showFirebaseNotification('All records are already synced', 'info');
                return;
            }
            
            if (!confirm(`Sync ${unsyncedRecords.length} unsynced records to Firebase Cloud?`)) {
                return;
            }
            
            this.showFirebaseNotification(`Syncing ${unsyncedRecords.length} records...`, 'info');
            
            let syncedCount = 0;
            let failedCount = 0;
            
            for (const record of unsyncedRecords) {
                try {
                    await this.savePropertyToFirebase(record);
                    syncedCount++;
                } catch (error) {
                    failedCount++;
                    console.error('Sync error for record:', record.propertyId, error);
                }
            }
            
            this.updateSyncStats();
            updateTable();
            
            if (syncedCount > 0) {
                this.showFirebaseNotification(`Successfully synced ${syncedCount} records`, 'success');
            }
            
            if (failedCount > 0) {
                this.showFirebaseNotification(`${failedCount} records failed to sync`, 'error');
            }
        }
        
        startPeriodicSync() {
            // Sync every 5 minutes if online
            setInterval(() => {
                if (this.isOnline && this.userId && this.syncQueue.length > 0 && !this.isSyncing) {
                    this.processSyncQueue();
                }
            }, 5 * 60 * 1000); // 5 minutes
        }
    }

    // ==============================================
    // LOGIN SYSTEM
    // ==============================================
    class LoginSystem {
        constructor() {
            this.maxAttempts = 5;
            this.remainingAttempts = this.maxAttempts;
            this.lockoutTime = 5 * 60 * 1000;
            this.isLocked = false;
            this.lockoutTimer = null;
            this.autoBackupInProgress = false;
            this.isLoggingOut = false;
            
            // Initialize Firebase
            this.initializeFirebase();
            
            // Setup enter key for login
            this.setupLoginEvents();
            
            // Check for existing Firebase session
            this.checkFirebaseSession();
        }
        
        initializeFirebase() {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                firebaseDb = firebase.firestore();
                firebaseAuth = firebase.auth();
                
                // Enable offline persistence
                firebaseDb.enablePersistence()
                    .catch((err) => {
                        console.error('Firebase persistence error:', err);
                    });
                    
                console.log('Firebase initialized successfully');
            } catch (error) {
                console.error('Firebase initialization error:', error);
            }
        }
        
        setupLoginEvents() {
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginButton = document.getElementById('loginButton');
            
            // Enter key support
            usernameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    passwordInput.focus();
                }
            });
            
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    this.attemptFirebaseLogin();
                }
            });
            
            // Auto-focus on username
            setTimeout(() => usernameInput.focus(), 100);
        }
        
        checkFirebaseSession() {
            if (!firebaseAuth) {
                console.error('Firebase Auth not initialized');
                return;
            }
            
            // Check Firebase auth state
            firebaseAuth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    this.loginSuccess(user.email, true);
                } else {
                    // User is signed out
                    this.checkLocalLockout();
                }
            });
        }
        
        checkLocalLockout() {
            // Check for local lockout (for failed attempts)
            const lockout = localStorage.getItem('lavmis_lockout');
            if (lockout) {
                const lockoutData = JSON.parse(lockout);
                const now = Date.now();
                
                if (now < lockoutData.until) {
                    this.lockout(lockoutData.until - now);
                    return;
                } else {
                    localStorage.removeItem('lavmis_lockout');
                }
            }
            
            // Check for remaining attempts
            const attempts = localStorage.getItem('lavmis_attempts');
            if (attempts) {
                this.remainingAttempts = parseInt(attempts);
                this.updateAttemptsDisplay();
            }
        }
        
        attemptFirebaseLogin() {
            if (this.isLocked) {
                return;
            }
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('loginError');
            const loginButton = document.getElementById('loginButton');
            
            // Clear previous error
            errorElement.textContent = '';
            
            // Validate inputs
            if (!username || !password) {
                errorElement.textContent = 'Please enter both email and password';
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(username)) {
                errorElement.textContent = 'Please enter a valid email address';
                return;
            }
            
            // Disable button while checking
            loginButton.disabled = true;
            loginButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> AUTHENTICATING...';
            
            // Firebase authentication
            firebaseAuth.signInWithEmailAndPassword(username, password)
                .then((userCredential) => {
                    // Signed in successfully
                    const user = userCredential.user;
                    this.loginSuccess(user.email, false);
                })
                .catch((error) => {
                    // Handle Firebase errors
                    this.handleFirebaseError(error);
                    
                    loginButton.disabled = false;
                    loginButton.innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> LOGIN TO LAVMIS';
                });
        }
        
        handleFirebaseError(error) {
            this.remainingAttempts--;
            localStorage.setItem('lavmis_attempts', this.remainingAttempts.toString());
            
            const errorElement = document.getElementById('loginError');
            let errorMessage = '';
            
            switch(error.code) {
                case 'auth/invalid-email':
                    errorMessage = 'Invalid email format';
                    break;
                case 'auth/user-disabled':
                    errorMessage = 'This account has been disabled';
                    break;
                case 'auth/user-not-found':
                    errorMessage = 'No account found with this email';
                    break;
                case 'auth/wrong-password':
                    errorMessage = 'Incorrect password';
                    break;
                case 'auth/too-many-requests':
                    errorMessage = 'Too many failed attempts. Try again later';
                    this.lockout(this.lockoutTime);
                    return;
                default:
                    errorMessage = `Authentication failed: ${error.message}`;
            }
            
            if (this.remainingAttempts <= 0) {
                // Lockout user
                const lockoutUntil = Date.now() + this.lockoutTime;
                const lockoutData = {
                    until: lockoutUntil,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('lavmis_lockout', JSON.stringify(lockoutData));
                this.lockout(this.lockoutTime);
                
                errorElement.textContent = 'Too many failed attempts. System locked for 5 minutes.';
                errorElement.style.color = '#e74c3c';
                
                // Shake animation
                document.querySelector('.login-container').classList.add('locked-out');
                setTimeout(() => {
                    document.querySelector('.login-container').classList.remove('locked-out');
                }, 500);
            } else {
                errorElement.textContent = `${errorMessage}. ${this.remainingAttempts} attempt(s) remaining.`;
                errorElement.style.color = '#f39c12';
                
                // Clear password field
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
            
            this.updateAttemptsDisplay();
        }
        
        lockout(timeRemaining) {
            this.isLocked = true;
            
            const loginContainer = document.querySelector('.login-container');
            const loginButton = document.getElementById('loginButton');
            const errorElement = document.getElementById('loginError');
            
            loginButton.disabled = true;
            loginButton.innerHTML = '<i class="fa-solid fa-lock"></i> SYSTEM LOCKED';
            
            const minutes = Math.floor(timeRemaining / 60000);
            const seconds = Math.floor((timeRemaining % 60000) / 1000);
            
            errorElement.textContent = `Too many failed attempts. Please try again in ${minutes}:${seconds.toString().padStart(2, '0')}`;
            errorElement.style.color = '#e74c3c';
            
            // Update countdown
            this.lockoutTimer = setInterval(() => {
                timeRemaining -= 1000;
                
                if (timeRemaining <= 0) {
                    clearInterval(this.lockoutTimer);
                    this.isLocked = false;
                    localStorage.removeItem('lavmis_lockout');
                    
                    loginButton.disabled = false;
                    loginButton.innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> LOGIN TO LAVMIS';
                    
                    errorElement.textContent = '';
                    this.remainingAttempts = this.maxAttempts;
                    this.updateAttemptsDisplay();
                } else {
                    const minutes = Math.floor(timeRemaining / 60000);
                    const seconds = Math.floor((timeRemaining % 60000) / 1000);
                    errorElement.textContent = `Too many failed attempts. Please try again in ${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }
        
        updateAttemptsDisplay() {
            const attemptsElement = document.getElementById('loginAttempts');
            
            if (this.isLocked) {
                attemptsElement.style.display = 'none';
            } else {
                attemptsElement.style.display = 'block';
                attemptsElement.textContent = `Attempts remaining: ${this.remainingAttempts}`;
                
                // Color code based on attempts
                if (this.remainingAttempts <= 2) {
                    attemptsElement.style.color = '#e74c3c';
                    attemptsElement.style.fontWeight = 'bold';
                } else if (this.remainingAttempts <= 3) {
                    attemptsElement.style.color = '#f39c12';
                } else {
                    attemptsElement.style.color = '#f39c12';
                }
            }
        }
        
        loginSuccess(email, fromSession = false) {
            // Reset attempts
            this.remainingAttempts = this.maxAttempts;
            localStorage.removeItem('lavmis_attempts');
            localStorage.removeItem('lavmis_lockout');
            
            // Show main app
            this.showMainApp(email);
            
            // Log the login
            if (!fromSession && typeof logger !== 'undefined') {
                logger.addLogEntry(`User "${email}" logged in successfully`, "success");
            }
        }
        
        showMainApp(email) {
            // Hide login modal
            document.getElementById('loginModal').style.display = 'none';
            
            // Show main content
            document.getElementById('mainContent').style.display = 'flex';
            
            // Update user info in status bar
            document.getElementById('loggedInUser').textContent = email;
            
            // Initialize the main application
            initializeApp();
        }
        
        initiateLogout() {
            if (this.autoBackupInProgress) {
                return;
            }
            
            this.isLoggingOut = true;
            
            // Check if there's data to backup
            const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            
            if (db.length === 0) {
                // No data to backup, proceed with logout
                this.confirmLogoutWithoutBackup();
            } else {
                // Show backup confirmation modal
                this.showBackupConfirmationModal();
            }
        }
        
        showBackupConfirmationModal() {
            const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            const backupCount = db.length;
            
            // Show backup progress modal
            const modal = document.getElementById('backupProgressModal');
            const recordCount = document.getElementById('backupRecordCount');
            const backupSize = document.getElementById('backupSize');
            const cancelBtn = document.getElementById('cancelBackupBtn');
            
            // Update stats
            recordCount.textContent = backupCount;
            
            // Calculate approximate size
            const dataStr = JSON.stringify(db);
            const sizeInMB = (new Blob([dataStr]).size / 1024 / 1024).toFixed(2);
            backupSize.textContent = `${sizeInMB} MB`;
            
            // Show modal
            modal.style.display = 'flex';
            
            // Update cancel button text
            cancelBtn.innerHTML = '<i class="fa-solid fa-times"></i> Skip Backup & Logout';
            cancelBtn.onclick = () => {
                this.confirmLogoutWithoutBackup();
            };
            
            // Start backup process
            this.createBackupForLogout();
        }
        
        createBackupForLogout() {
            this.autoBackupInProgress = true;
            
            const progressFill = document.getElementById('backupProgressFill');
            const progressText = document.getElementById('backupProgressText');
            const continueBtn = document.getElementById('continueLogoutBtn');
            const backupSuccess = document.getElementById('backupSuccess');
            const backupFileName = document.getElementById('backupFileName');
            
            // Reset UI
            progressFill.style.width = '0%';
            progressText.textContent = 'Starting backup process...';
            continueBtn.style.display = 'none';
            backupSuccess.style.display = 'none';
            
            // Simulate backup progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressFill.style.width = `${progress}%`;
                
                if (progress <= 30) {
                    progressText.textContent = 'Collecting property data...';
                } else if (progress <= 60) {
                    progressText.textContent = 'Processing evidence photos...';
                } else if (progress <= 90) {
                    progressText.textContent = 'Creating backup file...';
                } else {
                    progressText.textContent = 'Finalizing backup...';
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Create actual backup
                    this.performActualBackup().then((filename) => {
                        // Show success message
                        progressText.textContent = 'Backup completed successfully!';
                        backupSuccess.style.display = 'block';
                        backupFileName.textContent = `Backup saved as: ${filename}`;
                        
                        // Show continue button
                        continueBtn.style.display = 'block';
                        
                        // Log the backup
                        if (typeof logger !== 'undefined') {
                            const email = document.getElementById('loggedInUser').textContent;
                            logger.addLogEntry(`Auto-backup created before logout: ${filename}`, "success");
                        }
                        
                        this.autoBackupInProgress = false;
                    }).catch((error) => {
                        progressText.textContent = `Backup failed: ${error.message}`;
                        progressText.style.color = '#e74c3c';
                        this.autoBackupInProgress = false;
                        
                        // Still show continue button
                        continueBtn.style.display = 'block';
                        continueBtn.innerHTML = '<i class="fa-solid fa-right-from-bracket"></i> Logout Anyway';
                    });
                }
            }, 200);
        }
        
        performActualBackup() {
            return new Promise((resolve, reject) => {
                try {
                    const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
                    const logs = JSON.parse(localStorage.getItem('lavmis_logs') || '[]');
                    const userEmail = document.getElementById('loggedInUser').textContent;
                    
                    const backup = {
                        version: '1.0',
                        timestamp: new Date().toISOString(),
                        app: 'LAVMIS Pro',
                        userEmail: userEmail,
                        data: db,
                        logs: logs,
                        metadata: {
                            totalRecords: db.length,
                            totalLogs: logs.length,
                            backupType: 'auto_logout'
                        }
                    };
                    
                    const content = JSON.stringify(backup, null, 2);
                    const filename = `lavmis_auto_backup_${userEmail}_${new Date().toISOString().slice(0,10)}_${Date.now()}.json`;
                    
                    // Download file
                    const blob = new Blob([content], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    resolve(filename);
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        confirmLogoutWithoutBackup() {
            const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            
            if (db.length > 0) {
                // Show warning for skipping backup
                if (!confirm(` WARNING: You are about to logout WITHOUT creating a backup!\n\nYou have ${db.length} property records that will NOT be backed up.\n\nAre you sure you want to continue without backing up?`)) {
                    this.isLoggingOut = false;
                    document.getElementById('backupProgressModal').style.display = 'none';
                    return;
                }
            }
            
            // Proceed with logout
            this.finishLogout();
        }
        
        finishLogout() {
            // Hide backup modal
            document.getElementById('backupProgressModal').style.display = 'none';
            
            // Sign out from Firebase
            if (firebaseAuth) {
                firebaseAuth.signOut();
            }
            
            // Log the logout
            if (typeof logger !== 'undefined') {
                const email = document.getElementById('loggedInUser').textContent;
                logger.addLogEntry(`User "${email}" logged out`, "info");
            }
            
            // Reset application state
            resetAppState();
            
            // Show login modal again
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            
            // Reset login form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').textContent = '';
            
            // Reset logout state
            this.isLoggingOut = false;
            this.autoBackupInProgress = false;
            
            // Focus on username
            setTimeout(() => document.getElementById('username').focus(), 100);
        }
        
        cancelBackup() {
            document.getElementById('backupProgressModal').style.display = 'none';
            this.autoBackupInProgress = false;
            this.isLoggingOut = false;
        }
    }

    // ==============================================
    // LOGGING SYSTEM
    // ==============================================
    class Logger {
        constructor() {
            this.maxLogEntries = 100;
            this.logContainer = document.getElementById('logContent');
            this.initializeLog();
        }
        
        initializeLog() {
            let logs = JSON.parse(localStorage.getItem('lavmis_logs') || '[]');
            logs.forEach(log => this.addLogEntry(log.message, log.type, log.timestamp, false));
        }
        
        addLogEntry(message, type = 'info', timestamp = null, saveToStorage = true) {
            const logEntry = {
                timestamp: timestamp || new Date().toISOString(),
                message: message,
                type: type
            };
            
            // Add to UI
            const logElement = document.createElement('div');
            logElement.className = `log-entry ${type}`;
            logElement.innerHTML = `
                <div class="log-time">${this.formatTime(logEntry.timestamp)}</div>
                <div class="log-message">${message}</div>
            `;
            
            this.logContainer.insertBefore(logElement, this.logContainer.firstChild);
            
            // Limit number of displayed logs
            if (this.logContainer.children.length > this.maxLogEntries) {
                this.logContainer.removeChild(this.logContainer.lastChild);
            }
            
            // Save to storage
            if (saveToStorage) {
                let logs = JSON.parse(localStorage.getItem('lavmis_logs') || '[]');
                logs.unshift(logEntry);
                if (logs.length > this.maxLogEntries) {
                    logs = logs.slice(0, this.maxLogEntries);
                }
                localStorage.setItem('lavmis_logs', JSON.stringify(logs));
            }
            
            // Auto-scroll to top
            this.logContainer.scrollTop = 0;
        }
        
        formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + 
                   ' ' + date.toLocaleDateString([], {month: 'short', day: 'numeric'});
        }
        
        clearLog() {
            if (confirm("Clear all log entries?")) {
                localStorage.removeItem('lavmis_logs');
                this.logContainer.innerHTML = '';
                this.addLogEntry("Log cleared", "info");
            }
        }
    }

    // ==============================================
    // STORAGE MANAGEMENT
    // ==============================================
    class StorageManager {
        constructor() {
            this.updateStorageDisplay();
            setInterval(() => this.updateStorageDisplay(), 30000); // Update every 30 seconds
        }
        
        updateStorageDisplay() {
            // Update record count
            const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            document.getElementById('recordCount').textContent = `${db.length} property records`;
            
            // Calculate storage usage
            const dataSize = this.calculateDataSize();
            const storageFill = document.getElementById('storageFill');
            const storageUsed = document.getElementById('storageUsed');
            const storageTotal = document.getElementById('storageTotal');
            
            storageUsed.textContent = `${dataSize.toFixed(2)} MB`;
            
            if (navigator.storage && navigator.storage.estimate) {
                navigator.storage.estimate().then(estimate => {
                    const totalMB = (estimate.quota / 1024 / 1024).toFixed(2);
                    const usedPercent = (dataSize / totalMB * 100);
                    
                    storageTotal.textContent = `${totalMB} MB total`;
                    storageFill.style.width = `${Math.min(usedPercent, 100)}%`;
                });
            }
        }
        
        calculateDataSize() {
            let totalSize = 0;
            
            // Calculate database size
            const db = localStorage.getItem('lavmis_pro_db');
            if (db) {
                totalSize += new Blob([db]).size;
            }
            
            // Calculate logs size
            const logs = localStorage.getItem('lavmis_logs');
            if (logs) {
                totalSize += new Blob([logs]).size;
            }
            
            // Calculate evidence photos size (approximate)
            const evidenceData = this.getEvidenceDataSize();
            totalSize += evidenceData;
            
            return totalSize / 1024 / 1024; // Convert to MB
        }
        
        getEvidenceDataSize() {
            const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            let totalSize = 0;
            
            db.forEach(record => {
                if (record.evidence) {
                    // Base64 string size approximation (3/4 of string length)
                    totalSize += record.evidence.length * 0.75;
                }
            });
            
            return totalSize;
        }
        
        backupData(format = 'json') {
            const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            const logs = JSON.parse(localStorage.getItem('lavmis_logs') || '[]');
            const userEmail = document.getElementById('loggedInUser').textContent;
            
            const backup = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                app: 'LAVMIS Pro',
                userEmail: userEmail,
                data: db,
                logs: logs,
                metadata: {
                    totalRecords: db.length,
                    totalLogs: logs.length
                }
            };
            
            let content, filename, mimeType;
            
            if (format === 'json') {
                content = JSON.stringify(backup, null, 2);
                filename = `lavmis_properties_backup_${new Date().toISOString().slice(0,10)}.json`;
                mimeType = 'application/json';
            } else if (format === 'csv') {
                // Create CSV without evidence photos
                const csvData = db.map(record => ({
                    'Property ID': record.propertyId,
                    'Property Name': record.propertyName || '',
                    'Registration Type': record.registrationType || '',
                    'Plot Number': record.plotNumber || '',
                    'Block Number': record.blockNumber || '',
                    'District/City': record.districtCity || record.district || '',
                    'Subcounty': record.subcounty || '',
                    'Parish': record.parish || '',
                    'Village': record.village || '',
                    'Description': record.description || '',
                    'Date': record.formattedDate,
                    'Data Source': record.dataSource || '',
                    'Land Use': record.landUse,
                    'Price ($)': record.price,
                    'Size (Ha)': record.size,
                    'Rate ($/Ha)': record.rate,
                    'Latitude': record.latitude,
                    'Longitude': record.longitude,
                    'GPS Accuracy (m)': record.gpsAccuracy || 'N/A',
                    'Location Source': record.positionSource,
                    'Officer Name': record.officerName || '',
                    'Has Evidence': record.evidence ? 'Yes' : 'No',
                    'Sync Status': record.syncStatus || 'unknown',
                    'Firebase ID': record.firebaseId || 'N/A'
                }));
                
                const ws = XLSX.utils.json_to_sheet(csvData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "PropertyData");
                content = XLSX.write(wb, { bookType: 'csv', type: 'binary' });
                filename = `lavmis_properties_backup_${new Date().toISOString().slice(0,10)}.csv`;
                mimeType = 'text/csv';
                
                // Convert to blob
                const buffer = new ArrayBuffer(content.length);
                const view = new Uint8Array(buffer);
                for (let i = 0; i < content.length; i++) {
                    view[i] = content.charCodeAt(i) & 0xFF;
                }
                content = buffer;
            }
            
            // Download file
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            logger.addLogEntry(`Property data backed up as ${format.toUpperCase()}`, 'success');
            this.updateStorageDisplay();
        }
        
        restoreData(file) {
            const reader = new FileReader();
            
            reader.onload = (e) => {
                try {
                    const content = e.target.result;
                    let restoredData;
                    
                    if (file.name.endsWith('.json')) {
                        restoredData = JSON.parse(content);
                        
                        // Validate backup format
                        if (!restoredData.data || !Array.isArray(restoredData.data)) {
                            throw new Error('Invalid backup format');
                        }
                        
                        // Restore data
                        localStorage.setItem('lavmis_pro_db', JSON.stringify(restoredData.data));
                        
                        // Restore logs if available
                        if (restoredData.logs && Array.isArray(restoredData.logs)) {
                            localStorage.setItem('lavmis_logs', JSON.stringify(restoredData.logs));
                        }
                        
                    } else if (file.name.endsWith('.csv')) {
                        // Parse CSV
                        const workbook = XLSX.read(content, { type: 'binary' });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const csvData = XLSX.utils.sheet_to_json(worksheet);
                        
                        // Convert CSV data to our format
                        const restoredRecords = csvData.map(row => ({
                            id: Date.now() + Math.random(),
                            date: new Date().toISOString(),
                            formattedDate: row.Date || new Date().toLocaleDateString(),
                            propertyId: row['Property ID'] || '',
                            propertyName: row['Property Name'] || '',
                            registrationType: row['Registration Type'] || 'titled',
                            plotNumber: row['Plot Number'] || '',
                            blockNumber: row['Block Number'] || '',
                            districtCity: row['District/City'] || '',
                            district: row['District/City'] || '', // For backward compatibility
                            subcounty: row.Subcounty || '',
                            parish: row.Parish || '',
                            village: row.Village || '',
                            description: row.Description || '',
                            dataSource: row['Data Source'] || '',
                            landUse: row['Land Use'] || 'Unknown',
                            price: parseFloat(row['Price ($)']) || 0,
                            size: parseFloat(row['Size (Ha)']) || 0,
                            rate: parseFloat(row['Rate ($/Ha)']) || 0,
                            latitude: parseFloat(row.Latitude) || 0,
                            longitude: parseFloat(row.Longitude) || 0,
                            coordinates: `${parseFloat(row.Latitude) || 0}, ${parseFloat(row.Longitude) || 0}`,
                            evidence: null,
                            locationMode: 'imported',
                            positionSource: row['Location Source'] || 'CSV Import',
                            gpsAccuracy: row['GPS Accuracy (m)'] || null,
                            officerName: row['Officer Name'] || '',
                            syncStatus: 'pending',
                            firebaseId: row['Firebase ID'] || null
                        }));
                        
                        localStorage.setItem('lavmis_pro_db', JSON.stringify(restoredRecords));
                    }
                    
                    // Reload data
                    location.reload();
                    logger.addLogEntry(`Property data restored from ${file.name}`, "success");
                    
                } catch (error) {
                    logger.addLogEntry(`Restore failed: ${error.message}`, "error");
                    alert(`Restore failed: ${error.message}`);
                }
            };
            
            if (file.name.endsWith('.csv')) {
                reader.readAsBinaryString(file);
            } else {
                reader.readAsText(file);
            }
        }
        
        clearAllData() {
            // First confirmation
            if (!confirm(" WARNING: This will delete ALL property data, logs, and markers!\n\nThis includes:\n All saved property records\n All activity logs\n All map markers\n All evidence photos\n\nThis action CANNOT be undone!\n\nClick OK to proceed or Cancel to abort.")) {
                logger.addLogEntry("Clear All Data action cancelled by user", "warning");
                return;
            }
            
            // Second confirmation with custom modal
            this.showDangerConfirmation(
                "FINAL CONFIRMATION REQUIRED",
                "You are about to permanently delete ALL data. This action cannot be undone. To proceed, type 'DELETE ALL' in the field below.",
                "Delete All Data",
                () => {
                    // Backup current data first
                    const db = localStorage.getItem('lavmis_pro_db');
                    const logs = localStorage.getItem('lavmis_logs');
                    
                    // Store backup in memory for undo
                    sessionStorage.setItem('last_backup_db', db);
                    sessionStorage.setItem('last_backup_logs', logs);
                    
                    // Clear all data
                    localStorage.removeItem('lavmis_pro_db');
                    localStorage.removeItem('lavmis_logs');
                    localStorage.removeItem('lavmis_sync_queue');
                    
                    // Clear map
                    savedLayer.clearLayers();
                    liveLayer.clearLayers();
                    manualLayer.clearLayers();
                    accuracyLayer.clearLayers();
                    
                    // Update UI
                    updateTable();
                    logger.logContainer.innerHTML = '';
                    logger.addLogEntry(" ALL PROPERTY DATA CLEARED - This action was intentionally confirmed by user", "error");
                    this.updateStorageDisplay();
                    
                    // Update Firebase sync stats
                    if (firebaseDataManager) {
                        firebaseDataManager.updateSyncStats();
                    }
                    
                    // Show undo option
                    setTimeout(() => {
                        const undo = confirm(" All data has been cleared successfully!\n\nYou have a brief window to UNDO this action.\n\nClick OK to UNDO (restore data)\nClick Cancel to keep data cleared");
                        
                        if (undo) {
                            this.undoClear();
                        } else {
                            logger.addLogEntry("Data clearing confirmed - no undo requested", "warning");
                            // Clear the backup from session storage
                            sessionStorage.removeItem('last_backup_db');
                            sessionStorage.removeItem('last_backup_logs');
                        }
                    }, 100);
                }
            );
        }
        
        showDangerConfirmation(title, message, confirmText, callback) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay danger-confirmation';
            modal.style.display = 'flex';
            modal.style.zIndex = '5000';
            
            modal.innerHTML = `
                <div class="modal danger-modal">
                    <h3><i class="fa-solid fa-triangle-exclamation"></i> ${title}</h3>
                    <p style="margin: 20px 0; font-size: 0.9rem; line-height: 1.5; color: #2c3e50;">${message}</p>
                    
                    <div class="field-group" style="margin: 20px 0;">
                        <label for="confirmationInput">Type <span style="color: #e74c3c; font-weight: bold;">DELETE ALL</span> to confirm:</label>
                        <input type="text" id="confirmationInput" placeholder="Type DELETE ALL here" 
                               style="text-align: center; font-weight: bold; border: 2px solid #e74c3c;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                        <button onclick="this.closest('.modal-overlay').remove()" class="secondary">
                            <i class="fa-solid fa-times"></i> Cancel
                        </button>
                        <button id="confirmDangerBtn" class="danger-btn" disabled>
                            <i class="fa-solid fa-check"></i> ${confirmText}
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const input = document.getElementById('confirmationInput');
            const confirmBtn = document.getElementById('confirmDangerBtn');
            
            input.addEventListener('input', function() {
                confirmBtn.disabled = this.value !== 'DELETE ALL';
            });
            
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value === 'DELETE ALL') {
                    callback();
                    modal.remove();
                }
            });
            
            confirmBtn.addEventListener('click', function() {
                if (input.value === 'DELETE ALL') {
                    callback();
                    modal.remove();
                }
            });
            
            // Focus on input
            setTimeout(() => input.focus(), 100);
        }
        
        undoClear() {
            const db = sessionStorage.getItem('last_backup_db');
            const logs = sessionStorage.getItem('last_backup_logs');
            
            if (db) {
                localStorage.setItem('lavmis_pro_db', db);
                const parsedDb = JSON.parse(db);
                parsedDb.forEach(plotPoint);
                updateTable();
            }
            
            if (logs) {
                localStorage.setItem('lavmis_logs', logs);
                logger.initializeLog();
            }
            
            logger.addLogEntry("Property data restore completed", "success");
            this.updateStorageDisplay();
            
            // Update Firebase sync stats
            if (firebaseDataManager) {
                firebaseDataManager.updateSyncStats();
            }
        }
    }

    // ==============================================
    // APPLICATION INITIALIZATION
    // ==============================================
    function initializeApp() {
        // 1. Initialize map
        map = L.map('map', { 
            zoomControl: false,
            zoomSnap: 0.1,
            zoomDelta: 0.5
        }).setView([0.3476, 32.5825], 13); // Default to Kampala, Uganda
        
        // Initialize layers
        savedLayer = L.featureGroup().addTo(map);
        liveLayer = L.layerGroup().addTo(map);
        manualLayer = L.layerGroup().addTo(map);
        accuracyLayer = L.layerGroup().addTo(map);
        
        // 2. Initialize satellite layer
        satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            useCache: true,
            crossOrigin: true,
            cacheMaxAge: 604800000
        }).addTo(map);
        
        // 3. Initialize geographical dropdowns
        initializeGeographicalDropdowns();
        
        // 4. Generate initial Property ID
        generatePropertyId();
        
        // 5. Initialize logger
        logger = new Logger();
        logger.addLogEntry("LAVMIS Pro application started", "success");
        
        // 6. Initialize storage manager
        storageManager = new StorageManager();
        
        // 7. Initialize Firebase Data Manager
        firebaseDataManager = new FirebaseDataManager();
        
        // 8. Load saved data
        let db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
        db.forEach(plotPoint);
        updateTable();
        
        // 9. Initialize registration type
        setRegistrationType('titled');
        
        // 10. Initialize location mode
        setLocationMode('gps');
        
        // 11. Start GPS tracking
        startGPS();
        
        // 12. Initialize auto-center button
        document.getElementById('autoCenterToggle').classList.add('active');
        
        // 13. Update storage display
        storageManager.updateStorageDisplay();
        
        // 14. Setup map click handler
        map.on('click', function(e) {
            if (locationMode === 'manual' && isManualModeActive) {
                manualPos = [e.latlng.lat, e.latlng.lng];
                
                // Remove previous manual marker
                manualLayer.clearLayers();
                
                // Add new manual marker
                manualMarker = L.marker(e.latlng, {
                    icon: L.divIcon({
                        className: 'manual-marker',
                        html: `<div style="
                            width: 32px;
                            height: 32px;
                            background: rgba(142, 68, 173, 0.8);
                            border: 3px solid white;
                            border-radius: 50%;
                            box-shadow: 0 0 10px rgba(142, 68, 173, 0.8);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-weight: bold;
                        "><i class="fa-solid fa-map-pin"></i></div>`,
                        iconSize: [32, 32],
                        iconAnchor: [16, 32]
                    }),
                    zIndexOffset: 1000
                }).addTo(manualLayer);
                
                // Update coordinates display
                updateCoordinatesDisplay(manualPos[0], manualPos[1], 'Selected Point');
                
                // Enable save button and clear button
                document.getElementById('saveBtn').disabled = false;
                document.getElementById('clearPointBtn').disabled = false;
                
                // Center map on selected point
                map.setView(e.latlng, Math.max(map.getZoom(), 16));
                
                logger.addLogEntry("Point selected on map: " + manualPos.map(c => c.toFixed(6)).join(", "), "info");
            }
        });
        
        // Add initial log entry
        const email = document.getElementById('loggedInUser').textContent;
        logger.addLogEntry(`User "${email}" logged in successfully`, "success");
        
        // Setup beforeunload handler
        setupBeforeUnloadHandler();
    }
    
    function setupBeforeUnloadHandler() {
        window.addEventListener('beforeunload', function(e) {
            const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            if (db.length > 0 && !loginSystem.isLoggingOut) {
                // Show notification
                showAutoBackupNotification();
                
                // Create emergency backup in sessionStorage
                try {
                    const emergencyBackup = {
                        timestamp: Date.now(),
                        data: db,
                        recordCount: db.length
                    };
                    sessionStorage.setItem('lavmis_emergency_backup', JSON.stringify(emergencyBackup));
                } catch (error) {
                    console.error('Failed to create emergency backup:', error);
                }
                
                // Optional: Return confirmation message (may not work in all browsers)
                e.preventDefault();
                e.returnValue = 'You have unsaved data. A backup has been created.';
                return 'You have unsaved data. A backup has been created.';
            }
        });
    }
    
    function showAutoBackupNotification() {
        const notification = document.getElementById('autoBackupNotification');
        notification.style.display = 'flex';
        
        // Auto-hide after 2 seconds
        setTimeout(() => {
            notification.style.display = 'none';
        }, 2000);
    }
    
    function resetAppState() {
        // Clean up GPS
        if (gpsWatchId !== null) {
            navigator.geolocation.clearWatch(gpsWatchId);
            gpsWatchId = null;
        }
        
        // Reset variables
        currentPos = null;
        currentAccuracy = null;
        manualPos = null;
        evidencePhoto = null;
        manualMarker = null;
        isManualModeActive = false;
        autoCenterEnabled = true;
        lastGpsUpdate = null;
        
        // Clear map if exists
        if (map) {
            map.remove();
            map = null;
        }
        
        // Clear layers
        savedLayer = null;
        liveLayer = null;
        manualLayer = null;
        accuracyLayer = null;
        
        // Reset logger and storage manager
        logger = null;
        storageManager = null;
        satellite = null;
        
        // Reset Firebase
        firebaseDataManager = null;
        currentFirebaseUser = null;
    }

    // ==============================================
    // GPS FUNCTIONS
    // ==============================================
    function startGPS() {
        if (!navigator.geolocation) {
            updateGpsStatus(null);
            logger.addLogEntry("GPS hardware not available", "error");
            alert("GPS is not available on this device.");
            return;
        }
        
        const options = {
            enableHighAccuracy: true,
            maximumAge: 2000, // Accept cached position up to 2 seconds old
            timeout: 10000    // Wait up to 10 seconds for position
        };
        
        // Clear any existing watch
        if (gpsWatchId !== null) {
            navigator.geolocation.clearWatch(gpsWatchId);
        }
        
        gpsWatchId = navigator.geolocation.watchPosition(
            (position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const accuracy = position.coords.accuracy;
                const timestamp = position.timestamp;
                
                currentPos = [lat, lng];
                lastGpsUpdate = timestamp;
                
                // Log GPS updates periodically
                if (!lastGpsUpdate || (timestamp - lastGpsUpdate) > 30000) { // Log every 30 seconds
                    logger.addLogEntry(`GPS position updated: ${accuracy.toFixed(1)}m accuracy`, "info");
                    lastGpsUpdate = timestamp;
                }
                
                // Update GPS status
                updateGpsStatus(accuracy, currentPos);
                
                if (locationMode === 'gps') {
                    // Update live layer
                    liveLayer.clearLayers();
                    
                    // Add GPS marker
                    L.circleMarker(currentPos, {
                        radius: 8,
                        color: '#fff',
                        fillColor: '#3498db',
                        fillOpacity: 0.9,
                        weight: 2
                    }).addTo(liveLayer);
                    
                    // Update coordinates display
                    updateCoordinatesDisplay(currentPos[0], currentPos[1], 'GPS Location', accuracy);
                    
                    // Auto-center map if enabled
                    if (autoCenterEnabled) {
                        map.setView(currentPos, Math.max(map.getZoom(), 16));
                    }
                }
            },
            (error) => {
                console.error('GPS Error:', error);
                
                let errorMsg = 'GPS Error: ';
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMsg = 'GPS permission denied. Please enable location services.';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMsg = 'GPS position unavailable. Check device GPS.';
                        break;
                    case error.TIMEOUT:
                        errorMsg = 'GPS timeout. Retrying...';
                        // Retry GPS
                        setTimeout(startGPS, 1000);
                        break;
                    default:
                        errorMsg = `GPS Error: ${error.message}`;
                }
                
                logger.addLogEntry(errorMsg, "error");
                updateGpsStatus(null);
                updateCoordinatesDisplay(null, null, errorMsg);
                
                // Try to use last known position if available
                if (currentPos) {
                    liveLayer.clearLayers();
                    L.circleMarker(currentPos, {
                        radius: 8,
                        color: '#fff',
                        fillColor: '#e74c3c',
                        fillOpacity: 0.7,
                        weight: 2
                    }).addTo(liveLayer);
                    updateCoordinatesDisplay(currentPos[0], currentPos[1], 'Last Known Location', currentAccuracy);
                }
            },
            options
        );
    }
    
    function updateGpsStatus(accuracy, position = null) {
        const accuracyText = document.getElementById('gpsAccuracy');
        const accuracyFill = document.getElementById('gpsAccuracyFill');
        const gpsIcon = document.getElementById('gpsIcon');
        const statusText = document.getElementById('gpsStatusText');
        const statusDetail = document.getElementById('gpsStatusDetail');
        const saveBtn = document.getElementById('saveBtn');
        
        currentAccuracy = accuracy;
        
        if (accuracy === null) {
            accuracyText.textContent = '-- m';
            accuracyFill.style.width = '0%';
            accuracyFill.style.background = '#e74c3c';
            gpsIcon.className = 'fa-solid fa-satellite-slash';
            statusText.textContent = 'GPS Not Available';
            statusDetail.textContent = 'Waiting for GPS signal...';
            saveBtn.disabled = true;
            return;
        }
        
        accuracyText.textContent = `${accuracy.toFixed(1)} m`;
        
        // Calculate accuracy percentage (0-100%) where 3m = 100%, 50m = 0%
        let accuracyPercent;
        if (accuracy <= 3) {
            accuracyPercent = 100;
        } else if (accuracy >= 50) {
            accuracyPercent = 0;
        } else {
            accuracyPercent = Math.max(0, 100 - ((accuracy - 3) / 47 * 100));
        }
        
        accuracyFill.style.width = `${accuracyPercent}%`;
        
        // Determine color based on accuracy
        if (accuracy >= 3 && accuracy <= 20) {
            // Good accuracy (green)
            accuracyFill.style.background = '#27ae60';
            gpsIcon.className = 'fa-solid fa-satellite';
            statusText.textContent = 'GPS Ready';
            statusDetail.textContent = 'Good accuracy for data collection';
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<i class="fa-solid fa-save"></i> SAVE PROPERTY RECORD';
        } else if (accuracy < 3) {
            // Too accurate (might be mock location) - show warning
            accuracyFill.style.background = '#f39c12';
            gpsIcon.className = 'fa-solid fa-satellite';
            statusText.textContent = 'High Accuracy';
            statusDetail.textContent = 'Accuracy too high (possible mock location)';
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fa-solid fa-exclamation-triangle"></i> Accuracy Too High';
        } else if (accuracy <= 30) {
            // Moderate accuracy (yellow)
            accuracyFill.style.background = '#f39c12';
            gpsIcon.className = 'fa-solid fa-satellite';
            statusText.textContent = 'Moderate Accuracy';
            statusDetail.textContent = 'Move for better GPS signal';
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fa-solid fa-save"></i> WAIT FOR BETTER GPS';
        } else {
            // Poor accuracy (red)
            accuracyFill.style.background = '#e74c3c';
            gpsIcon.className = 'fa-solid fa-satellite';
            statusText.textContent = 'Poor Accuracy';
            statusDetail.textContent = 'Move to open area for better GPS';
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fa-solid fa-save"></i> NEED BETTER GPS';
        }
        
        // Update accuracy circle on map
        if (position) {
            updateAccuracyCircle(position, accuracy);
        }
    }
    
    function updateAccuracyCircle(position, accuracy) {
        accuracyLayer.clearLayers();
        
        if (accuracy && accuracy <= 100) { // Only show up to 100m accuracy circle
            const circle = L.circle(position, {
                radius: accuracy,
                color: '#3498db',
                fillColor: '#3498db',
                fillOpacity: 0.1,
                weight: 1,
                dashArray: '5, 5'
            }).addTo(accuracyLayer);
            
            // Add accuracy text
            L.marker(position, {
                icon: L.divIcon({
                    className: 'accuracy-label',
                    html: `<div style="
                        background: rgba(52, 152, 219, 0.8);
                        color: white;
                        padding: 2px 6px;
                        border-radius: 10px;
                        font-size: 10px;
                        white-space: nowrap;
                    ">${accuracy.toFixed(1)}m</div>`,
                    iconSize: [60, 20],
                    iconAnchor: [30, 20]
                })
            }).addTo(accuracyLayer);
        }
    }
    
    function centerOnGPS() {
        if (currentPos) {
            map.setView(currentPos, Math.max(map.getZoom(), 16));
            logger.addLogEntry("Map centered on current GPS position", "info");
        } else {
            alert("No GPS position available. Waiting for GPS signal...");
        }
    }
    
    function toggleAutoCenter() {
        autoCenterEnabled = !autoCenterEnabled;
        const toggleBtn = document.getElementById('autoCenterToggle');
        
        if (autoCenterEnabled) {
            toggleBtn.classList.add('active');
            toggleBtn.title = 'Auto-center ON - Click to disable';
            logger.addLogEntry("Auto-center enabled", "info");
            
            // If we have a current position, center on it
            if (currentPos) {
                map.setView(currentPos, Math.max(map.getZoom(), 16));
            }
        } else {
            toggleBtn.classList.remove('active');
            toggleBtn.title = 'Auto-center OFF - Click to enable';
            logger.addLogEntry("Auto-center disabled", "info");
        }
    }

    // ==============================================
    // LOCATION MODE FUNCTIONS
    // ==============================================
    function setLocationMode(mode) {
        locationMode = mode;
        isManualModeActive = (mode === 'manual');
        
        // Update toggle buttons
        document.getElementById('gpsToggle').classList.toggle('active', mode === 'gps');
        document.getElementById('manualToggle').classList.toggle('active', mode === 'manual');
        
        // Enable/disable save button based on mode
        const saveBtn = document.getElementById('saveBtn');
        if (mode === 'manual') {
            saveBtn.disabled = !manualPos;
            saveBtn.innerHTML = '<i class="fa-solid fa-save"></i> SAVE PROPERTY RECORD';
            logger.addLogEntry("Switched to manual point selection mode", "info");
        } else {
            // GPS mode: button enabled only when accuracy is good
            saveBtn.disabled = !(currentAccuracy && currentAccuracy >= 3 && currentAccuracy <= 20);
            if (!saveBtn.disabled) {
                saveBtn.innerHTML = '<i class="fa-solid fa-save"></i> SAVE PROPERTY RECORD';
            }
            logger.addLogEntry("Switched to GPS auto mode", "info");
        }
        
        // Clear accuracy layer in manual mode
        if (mode === 'manual') {
            accuracyLayer.clearLayers();
        }
        
        // Update coordinates display
        if (mode === 'gps' && currentPos) {
            updateCoordinatesDisplay(currentPos[0], currentPos[1], 'GPS Location', currentAccuracy);
        } else if (mode === 'manual' && manualPos) {
            updateCoordinatesDisplay(manualPos[0], manualPos[1], 'Selected Point');
        } else if (mode === 'manual') {
            updateCoordinatesDisplay(null, null, 'Click on map to select a point');
        }
        
        // Update cursor
        document.getElementById('map').style.cursor = mode === 'manual' ? 'crosshair' : 'default';
    }
    
    function clearManualPoint() {
        manualPos = null;
        manualMarker = null;
        manualLayer.clearLayers();
        document.getElementById('clearPointBtn').disabled = true;
        document.getElementById('saveBtn').disabled = true;
        updateCoordinatesDisplay(null, null, 'Click on map to select a point');
        logger.addLogEntry("Manual point cleared", "info");
    }
    
    function updateCoordinatesDisplay(lat, lng, source, accuracy = null) {
        const coordDisplay = document.getElementById('coordinates');
        
        if (lat !== null && lng !== null) {
            let html = `<div style="font-weight: 600; color: var(--primary);"><i class="fa-solid fa-map-pin"></i> ${source}</div>
                <div style="color: #27ae60; font-weight: bold; margin-top: 6px; font-size: 0.9rem;">
                    ${lat.toFixed(6)}, ${lng.toFixed(6)}
                </div>`;
            
            if (accuracy !== null) {
                html += `<div style="font-size: 0.75rem; color: ${getAccuracyColor(accuracy)}; margin-top: 4px; font-weight: 500;">
                    Accuracy: ${accuracy.toFixed(1)}m
                </div>`;
            }
            
            coordDisplay.innerHTML = html;
        } else {
            coordDisplay.innerHTML = `
                <div style="font-weight: 600; color: var(--primary);"><i class="fa-solid fa-info-circle"></i> ${source || 'Waiting for location...'}</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 6px;">
                    ${locationMode === 'gps' ? 'Waiting for GPS signal' : 'Click on map to select a point'}
                </div>
            `;
        }
    }
    
    function getAccuracyColor(accuracy) {
        if (accuracy >= 3 && accuracy <= 20) return '#27ae60';
        if (accuracy < 3) return '#f39c12';
        if (accuracy <= 30) return '#f39c12';
        return '#e74c3c';
    }

    // ==============================================
    // EVIDENCE PHOTO HANDLING
    // ==============================================
    function capturePhoto() {
        document.getElementById('photoInput').click();
    }
    
    function handlePhotoUpload(event) {
        const file = event.target.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                evidencePhoto = e.target.result;
                document.getElementById('imagePreview').src = evidencePhoto;
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('removePhotoBtn').style.display = 'block';
                logger.addLogEntry("Evidence photo captured: " + file.name, "success");
            };
            reader.readAsDataURL(file);
        }
    }
    
    function removePhoto() {
        evidencePhoto = null;
        document.getElementById('imagePreview').style.display = 'none';
        document.getElementById('removePhotoBtn').style.display = 'none';
        document.getElementById('photoInput').value = '';
        logger.addLogEntry("Evidence photo removed", "info");
    }

    // ==============================================
    // DATA SAVING FUNCTION
    // ==============================================
    async function saveData() {
        let position;
        let positionSource;
        let accuracy = null;
        
        if (locationMode === 'gps') {
            if (!currentPos) {
                alert("Waiting for GPS signal...");
                return;
            }
            
            // Validate GPS accuracy
            if (!currentAccuracy || currentAccuracy < 3 || currentAccuracy > 20) {
                alert(`GPS accuracy (${currentAccuracy ? currentAccuracy.toFixed(1) : 'unknown'}m) is outside required range (3-20m).\n\nPlease move to an open area and wait for better GPS accuracy.`);
                return;
            }
            
            position = currentPos;
            positionSource = 'GPS';
            accuracy = currentAccuracy;
        } else {
            if (!manualPos) {
                alert("Please select a point on the map first.");
                return;
            }
            position = manualPos;
            positionSource = 'Manual Selection';
        }

        // Get manual entry values if used
        const districtCity = document.getElementById('districtCityManual').style.display === 'block' 
            ? document.getElementById('districtCityManual').value.trim()
            : document.getElementById('districtCity').value.trim();
        
        const subcounty = document.getElementById('subcountyManual').style.display === 'block'
            ? document.getElementById('subcountyManual').value.trim()
            : document.getElementById('subcounty').value.trim();
        
        const parish = document.getElementById('parishManual').style.display === 'block'
            ? document.getElementById('parishManual').value.trim()
            : document.getElementById('parish').value.trim();
        
        const village = document.getElementById('villageManual').style.display === 'block'
            ? document.getElementById('villageManual').value.trim()
            : document.getElementById('village').value.trim();

        // Validate required fields
        const propertyId = document.getElementById('propertyId').value.trim();
        const propertyName = document.getElementById('propertyName').value.trim();
        const plotNumber = document.getElementById('plotNumber').value.trim();
        const blockNumber = document.getElementById('blockNumber').value.trim();
        const description = document.getElementById('description').value.trim();
        const dataSource = document.getElementById('dataSource').value.trim();
        const price = parseFloat(document.getElementById('price').value);
        const size = parseFloat(document.getElementById('size').value);
        const landUse = document.getElementById('use').value;
        const officerName = document.getElementById('officerName').value.trim();
        
        if (!propertyId) {
            alert("Please generate Property ID.");
            return;
        }
        
        if (!districtCity) {
            alert("Please select or enter District/City.");
            return;
        }
        
        if (!subcounty) {
            alert("Please select or enter Subcounty.");
            return;
        }
        
        if (!parish) {
            alert("Please select or enter Parish.");
            return;
        }
        
        if (!village) {
            alert("Please select or enter Village.");
            return;
        }
        
        if (!dataSource) {
            alert("Please select Data Source.");
            return;
        }
        
        if (!price || !size || price <= 0 || size <= 0) {
            alert("Please enter valid price and size values.");
            return;
        }
        
        if (!landUse) {
            alert("Please select Land Use.");
            return;
        }
        
        if (!officerName) {
            alert("Please enter the Name of Officer (Data Collector).");
            return;
        }
        
        // Validate titled properties require plot number
        if (registrationType === 'titled' && !plotNumber) {
            alert("For titled properties, Plot Number is required.");
            return;
        }

        const record = {
            id: Date.now(),
            date: new Date().toISOString(),
            formattedDate: new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }),
            propertyId: propertyId,
            propertyName: propertyName,
            registrationType: registrationType,
            plotNumber: plotNumber,
            blockNumber: blockNumber,
            districtCity: districtCity,
            district: districtCity, // For backward compatibility
            subcounty: subcounty,
            parish: parish,
            village: village,
            description: description,
            dataSource: dataSource,
            landUse: landUse,
            price: price,
            size: size,
            rate: (price / size).toFixed(2),
            latitude: position[0].toFixed(6),
            longitude: position[1].toFixed(6),
            coordinates: `${position[0].toFixed(6)}, ${position[1].toFixed(6)}`,
            evidence: evidencePhoto,
            locationMode: locationMode,
            positionSource: positionSource,
            gpsAccuracy: accuracy ? accuracy.toFixed(1) : null,
            officerName: officerName,
            syncStatus: 'pending'
        };

        // Save to local storage
        let db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
        db.push(record);
        localStorage.setItem('lavmis_pro_db', JSON.stringify(db));

        // Save to Firebase
        try {
            if (firebaseDataManager) {
                const result = await firebaseDataManager.savePropertyToFirebase(record);
                
                if (result.firebaseId) {
                    // Update local record with Firebase ID
                    const index = db.findIndex(r => r.id === record.id);
                    if (index !== -1) {
                        db[index].firebaseId = result.firebaseId;
                        db[index].syncStatus = 'synced';
                        db[index].syncedAt = new Date().toISOString();
                        localStorage.setItem('lavmis_pro_db', JSON.stringify(db));
                        
                        // Update property sync status in form
                        updatePropertySyncStatus('synced');
                    }
                } else {
                    // Update local record with queued status
                    const index = db.findIndex(r => r.id === record.id);
                    if (index !== -1) {
                        db[index].syncStatus = 'queued';
                        localStorage.setItem('lavmis_pro_db', JSON.stringify(db));
                        
                        // Update property sync status in form
                        updatePropertySyncStatus('queued');
                    }
                }
            }
        } catch (error) {
            console.error('Firebase save error:', error);
            // Record will remain with pending status
            updatePropertySyncStatus('pending');
        }

        plotPoint(record);
        updateTable();
        clearForm();
        
        // Generate new Property ID for next record
        generatePropertyId();
        
        // Clear manual point after saving
        if (locationMode === 'manual') {
            clearManualPoint();
        }
        
        // Update sync stats
        if (firebaseDataManager) {
            firebaseDataManager.updateSyncStats();
        }
        
        // Update storage display
        if (storageManager) {
            storageManager.updateStorageDisplay();
        }
        
        alert(` Property record saved successfully!\n ID: ${record.propertyId}\n Name: ${record.propertyName || 'Not provided'}\n Plot: ${record.plotNumber || 'Untitled'}\n Location: ${record.coordinates}\n Accuracy: ${accuracy ? accuracy.toFixed(1) + 'm' : 'Manual'}\n Rate: $${record.rate}/Ha`);
    }
    
    function updatePropertySyncStatus(status) {
        const syncStatusElement = document.getElementById('propertySyncStatus');
        if (!syncStatusElement) return;
        
        syncStatusElement.style.display = 'inline-flex';
        
        switch(status) {
            case 'synced':
                syncStatusElement.className = 'sync-status sync-synced';
                syncStatusElement.innerHTML = '<i class="fa-solid fa-cloud-check"></i> Synced';
                break;
            case 'queued':
                syncStatusElement.className = 'sync-status sync-queued';
                syncStatusElement.innerHTML = '<i class="fa-solid fa-clock"></i> Queued';
                break;
            case 'pending':
                syncStatusElement.className = 'sync-status sync-pending';
                syncStatusElement.innerHTML = '<i class="fa-solid fa-hourglass-half"></i> Pending';
                break;
            default:
                syncStatusElement.style.display = 'none';
        }
    }
    
    function clearForm() {
        // Don't clear Property ID (it's auto-generated)
        document.getElementById('propertyName').value = '';
        // Don't clear registration type
        document.getElementById('plotNumber').value = '';
        document.getElementById('blockNumber').value = '';
        
        // Reset geographical dropdowns
        document.getElementById('districtCity').value = '';
        document.getElementById('districtCityManual').style.display = 'none';
        document.getElementById('districtCity').style.display = 'block';
        document.getElementById('districtCity').disabled = false;
        
        document.getElementById('subcounty').value = '';
        document.getElementById('subcountyManual').style.display = 'none';
        document.getElementById('subcounty').style.display = 'block';
        document.getElementById('subcounty').disabled = true;
        
        document.getElementById('parish').value = '';
        document.getElementById('parishManual').style.display = 'none';
        document.getElementById('parish').style.display = 'block';
        document.getElementById('parish').disabled = true;
        
        document.getElementById('village').value = '';
        document.getElementById('villageManual').style.display = 'none';
        document.getElementById('village').style.display = 'block';
        document.getElementById('village').disabled = true;
        
        document.getElementById('description').value = '';
        document.getElementById('dataSource').selectedIndex = 0;
        document.getElementById('price').value = '';
        document.getElementById('size').value = '';
        document.getElementById('use').selectedIndex = 0;
        document.getElementById('officerName').value = '';
        removePhoto();
        
        // Reset dropdown states
        updateSubcounties();
        
        // Clear sync status
        const syncStatusElement = document.getElementById('propertySyncStatus');
        if (syncStatusElement) {
            syncStatusElement.style.display = 'none';
        }
    }

    // ==============================================
    // MAPPING FUNCTIONS
    // ==============================================
    function plotPoint(record) {
        const iconColor = getColorForUse(record.landUse);
        const marker = L.marker([record.latitude, record.longitude], {
            icon: L.divIcon({
                className: 'saved-marker',
                html: `<div style="
                    width: 24px;
                    height: 24px;
                    background: ${iconColor};
                    border: 2px solid white;
                    border-radius: 50%;
                    box-shadow: 0 0 5px rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 10px;
                "><i class="fa-solid fa-map-pin"></i></div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 24]
            }),
            title: `${record.propertyName || 'Property'} - $${record.rate}/Ha`
        }).addTo(savedLayer);
        
        // Add sync status badge if applicable
        let syncBadge = '';
        if (record.syncStatus) {
            let syncClass = '';
            let syncIcon = '';
            let syncText = '';
            
            switch(record.syncStatus) {
                case 'synced':
                    syncClass = 'sync-synced';
                    syncIcon = 'fa-cloud-check';
                    syncText = 'Synced';
                    break;
                case 'queued':
                    syncClass = 'sync-queued';
                    syncIcon = 'fa-clock';
                    syncText = 'Queued';
                    break;
                case 'pending':
                    syncClass = 'sync-pending';
                    syncIcon = 'fa-hourglass-half';
                    syncText = 'Pending';
                    break;
            }
            
            if (syncClass) {
                syncBadge = `<div class="sync-status ${syncClass}" style="margin-top: 5px;">
                    <i class="fa-solid ${syncIcon}"></i> ${syncText}
                </div>`;
            }
        }
        
        let popupContent = `
            <div style="min-width: 250px;">
                <h4 style="margin: 0 0 10px 0; color: ${iconColor};">
                    <i class="fa-solid fa-house"></i> ${record.propertyName || 'Property'}
                </h4>
                <p><strong>Property ID:</strong> ${record.propertyId}</p>
                <p><strong>Registration:</strong> ${record.registrationType || 'titled'}</p>
                <p><strong>Plot:</strong> ${record.plotNumber || 'N/A'}</p>
                <p><strong>Block:</strong> ${record.blockNumber || 'N/A'}</p>
                <p><strong>Location:</strong> ${record.village}, ${record.parish}</p>
                <p><strong>District/City:</strong> ${record.districtCity}</p>
                <p><strong>Subcounty:</strong> ${record.subcounty}</p>
                <p><strong>Data Source:</strong> ${record.dataSource}</p>
                <p><strong>Land Use:</strong> ${record.landUse}</p>
                <p><strong>Price:</strong> $${record.price}</p>
                <p><strong>Size:</strong> ${record.size} Ha</p>
                <p><strong>Rate:</strong> $${record.rate}/Ha</p>
                <p><strong>Officer:</strong> ${record.officerName}</p>
                <p><strong>Date:</strong> ${record.formattedDate}</p>
                <p><strong>Coordinates:</strong> ${record.coordinates}</p>
                <p><strong>Source:</strong> ${record.positionSource}</p>
                ${record.gpsAccuracy ? `<p><strong>GPS Accuracy:</strong> ${record.gpsAccuracy}m</p>` : ''}
                ${record.description ? `<p><strong>Description:</strong> ${record.description}</p>` : ''}
                ${syncBadge}
        `;
        
        if (record.evidence) {
            popupContent += `
                <p><strong>Evidence:</strong></p>
                <img src="${record.evidence}" style="max-width: 150px; border-radius: 4px; margin-top: 5px;">
            `;
        }
        
        popupContent += `
                <hr style="margin: 10px 0;">
                <button onclick="showPreview(${record.id})" style="width: 100%; padding: 5px; background: ${iconColor}; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    View Property Details
                </button>
            </div>
        `;
        
        marker.bindPopup(popupContent);
        marker.recordId = record.id;
        
        marker.on('click', function() {
            showPreview(record.id);
        });
    }
    
    function getColorForUse(landUse) {
        const colors = {
            'Residential': '#3498db',
            'Commercial': '#e74c3c',
            'Agricultural': '#27ae60',
            'Industrial': '#f39c12',
            'Recreational': '#9b59b6',
            'Mixed Use': '#8e44ad',
            'Vacant Land': '#95a5a6',
            'Forest': '#16a085',
            'Wetland': '#2980b9'
        };
        return colors[landUse] || '#3498db';
    }
    
    function clearAllMarkers() {
        if (confirm("Are you sure you want to remove all property markers from the map? This won't delete your saved data.")) {
            savedLayer.clearLayers();
            // Replot all points from database
            let db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
            db.forEach(plotPoint);
            logger.addLogEntry("All property markers cleared", "warning");
        }
    }

    // ==============================================
    // DATA TABLE AND PREVIEW
    // ==============================================
    function updateTable() {
        const tbody = document.querySelector("#dataTable tbody");
        tbody.innerHTML = "";
        let db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
        
        db.reverse().forEach(item => {
            const row = tbody.insertRow();
            row.dataset.id = item.id;
            
            // Determine sync status display
            let syncDisplay = '';
            if (item.syncStatus) {
                switch(item.syncStatus) {
                    case 'synced':
                        syncDisplay = '<span class="sync-status sync-synced" style="font-size: 0.7rem;"><i class="fa-solid fa-cloud-check"></i></span>';
                        break;
                    case 'queued':
                        syncDisplay = '<span class="sync-status sync-queued" style="font-size: 0.7rem;"><i class="fa-solid fa-clock"></i></span>';
                        break;
                    case 'pending':
                        syncDisplay = '<span class="sync-status sync-pending" style="font-size: 0.7rem;"><i class="fa-solid fa-hourglass-half"></i></span>';
                        break;
                    default:
                        syncDisplay = '';
                }
            }
            
            row.innerHTML = `
                <td>${item.propertyId}</td>
                <td>${item.propertyName || 'Unnamed'}</td>
                <td>${item.plotNumber || 'N/A'}</td>
                <td>$${item.rate}</td>
                <td>${syncDisplay}</td>
                <td>
                    <button onclick="goToLocation(${item.latitude}, ${item.longitude})" title="Go to property location" style="padding: 6px; border-radius: 4px;">
                        <i class="fa-solid fa-location-arrow"></i>
                    </button>
                    <button onclick="showPreview(${item.id})" title="View property details" style="padding: 6px; border-radius: 4px; margin-left: 5px;">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </td>
            `;
            
            row.addEventListener('click', (e) => {
                if (!e.target.tagName === 'BUTTON') {
                    showPreview(item.id);
                }
            });
        });
    }
    
    function goToLocation(lat, lng) {
        map.setView([lat, lng], 18);
        logger.addLogEntry(`Navigated to property coordinates: ${lat}, ${lng}`, "info");
    }
    
    function showPreview(recordId) {
        const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
        const record = db.find(r => r.id === recordId);
        
        if (!record) return;
        
        // Determine sync status display
        let syncDisplay = '';
        if (record.syncStatus) {
            switch(record.syncStatus) {
                case 'synced':
                    syncDisplay = '<div class="preview-item"><div class="preview-label">Sync Status:</div><div class="preview-value"><span class="sync-status sync-synced"><i class="fa-solid fa-cloud-check"></i> Synced to Firebase</span></div></div>';
                    if (record.firebaseId) {
                        syncDisplay += `<div class="preview-item"><div class="preview-label">Firebase ID:</div><div class="preview-value" style="font-size: 0.8rem;">${record.firebaseId}</div></div>`;
                    }
                    break;
                case 'queued':
                    syncDisplay = '<div class="preview-item"><div class="preview-label">Sync Status:</div><div class="preview-value"><span class="sync-status sync-queued"><i class="fa-solid fa-clock"></i> Queued for sync</span></div></div>';
                    break;
                case 'pending':
                    syncDisplay = '<div class="preview-item"><div class="preview-label">Sync Status:</div><div class="preview-value"><span class="sync-status sync-pending"><i class="fa-solid fa-hourglass-half"></i> Pending sync</span></div></div>';
                    break;
            }
        }
        
        document.getElementById('previewContent').innerHTML = `
            <div class="preview-item">
                <div class="preview-label">Property ID:</div>
                <div class="preview-value">${record.propertyId}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Property Name:</div>
                <div class="preview-value">${record.propertyName || 'Not provided'}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Registration Type:</div>
                <div class="preview-value">${record.registrationType || 'titled'}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Plot Number:</div>
                <div class="preview-value">${record.plotNumber || 'N/A'}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Block Number:</div>
                <div class="preview-value">${record.blockNumber || 'N/A'}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">District/City:</div>
                <div class="preview-value">${record.districtCity}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Subcounty:</div>
                <div class="preview-value">${record.subcounty}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Parish:</div>
                <div class="preview-value">${record.parish}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Village:</div>
                <div class="preview-value">${record.village}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Data Source:</div>
                <div class="preview-value">${record.dataSource}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Land Use:</div>
                <div class="preview-value">${record.landUse}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Price:</div>
                <div class="preview-value">$${record.price}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Size:</div>
                <div class="preview-value">${record.size} Ha</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Rate/Ha:</div>
                <div class="preview-value">$${record.rate}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Coordinates:</div>
                <div class="preview-value">${record.coordinates}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Officer Name:</div>
                <div class="preview-value">${record.officerName}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Date:</div>
                <div class="preview-value">${record.formattedDate}</div>
            </div>
            <div class="preview-item">
                <div class="preview-label">Location Source:</div>
                <div class="preview-value">${record.positionSource}</div>
            </div>
            ${record.gpsAccuracy ? `
            <div class="preview-item">
                <div class="preview-label">GPS Accuracy:</div>
                <div class="preview-value">${record.gpsAccuracy}m</div>
            </div>
            ` : ''}
            ${syncDisplay}
            ${record.description ? `
            <div class="preview-item" style="grid-column: span 2;">
                <div class="preview-label">Description/Remarks:</div>
                <div class="preview-value">${record.description}</div>
            </div>
            ` : ''}
            ${record.evidence ? `
                <div class="preview-item" style="grid-column: span 2;">
                    <div class="preview-label">Evidence Photo:</div>
                    <img src="${record.evidence}" style="max-width: 100%; max-height: 150px; margin-top: 5px; border-radius: 4px;">
                </div>
            ` : ''}
        `;
        
        document.getElementById('dataPreview').style.display = 'block';
        
        // Scroll to preview
        document.getElementById('dataPreview').scrollIntoView({ behavior: 'smooth' });
        
        // Center map on record location
        map.setView([record.latitude, record.longitude], 16);
        
        logger.addLogEntry(`Viewing property record: ${record.propertyName || 'Unnamed'} (ID: ${record.propertyId})`, "info");
    }
    
    function hidePreview() {
        document.getElementById('dataPreview').style.display = 'none';
    }

    // ==============================================
    // CACHE FUNCTIONS
    // ==============================================
    function cacheTiles() {
        logger.addLogEntry("Map caching started", "info");
        alert("Scanning visible area... Keep the app open. Map tiles are being saved to your internal device storage.");
        document.getElementById('cache-status').innerText = "Storage Status: Tiles Cached Locally";
    }
    
    function clearCache() {
        if (confirm("Delete all cached map imagery?")) {
            if (satellite && satellite.seed) {
                satellite.seed([], 0, 0);
            }
            logger.addLogEntry("Map cache cleared", "warning");
            location.reload();
        }
    }

    // ==============================================
    // EXPORT FUNCTIONS
    // ==============================================
    function exportData() {
        const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
        
        // Prepare data for export with coordinates
        const exportData = db.map(record => ({
            'Property ID': record.propertyId,
            'Property Name': record.propertyName || '',
            'Registration Type': record.registrationType || '',
            'Plot Number': record.plotNumber || '',
            'Block Number': record.blockNumber || '',
            'District/City': record.districtCity || record.district || '',
            'Subcounty': record.subcounty || '',
            'Parish': record.parish || '',
            'Village': record.village || '',
            'Description/Remarks': record.description || '',
            'Date': record.formattedDate,
            'Data Source': record.dataSource || '',
            'Land Use': record.landUse,
            'Total Price ($)': record.price,
            'Size (Ha)': record.size,
            'Rate per Ha ($)': record.rate,
            'Latitude': record.latitude,
            'Longitude': record.longitude,
            'Coordinates': record.coordinates,
            'Location Source': record.positionSource,
            'GPS Accuracy (m)': record.gpsAccuracy || 'N/A',
            'Officer Name': record.officerName || '',
            'Has Evidence': record.evidence ? 'Yes' : 'No',
            'Sync Status': record.syncStatus || 'unknown',
            'Firebase ID': record.firebaseId || 'N/A'
        }));
        
        const ws = XLSX.utils.json_to_sheet(exportData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "PropertyData");
        XLSX.writeFile(wb, `LAVMIS_Properties_${new Date().toISOString().slice(0,10)}.xlsx`);
        
        logger.addLogEntry("Property data exported to Excel", "success");
    }
    
    function exportGeoJSON() {
        const db = JSON.parse(localStorage.getItem('lavmis_pro_db') || '[]');
        
        const geoJson = {
            type: "FeatureCollection",
            features: db.map(record => ({
                type: "Feature",
                geometry: {
                    type: "Point",
                    coordinates: [parseFloat(record.longitude), parseFloat(record.latitude)]
                },
                properties: {
                    id: record.id,
                    propertyId: record.propertyId,
                    propertyName: record.propertyName || '',
                    registrationType: record.registrationType || '',
                    plotNumber: record.plotNumber || '',
                    blockNumber: record.blockNumber || '',
                    districtCity: record.districtCity || record.district || '',
                    subcounty: record.subcounty || '',
                    parish: record.parish || '',
                    village: record.village || '',
                    description: record.description || '',
                    dataSource: record.dataSource || '',
                    date: record.formattedDate,
                    landUse: record.landUse,
                    price: record.price,
                    size: record.size,
                    rate: record.rate,
                    coordinates: record.coordinates,
                    source: record.positionSource,
                    accuracy: record.gpsAccuracy,
                    officerName: record.officerName || '',
                    hasEvidence: !!record.evidence,
                    syncStatus: record.syncStatus || 'unknown',
                    firebaseId: record.firebaseId || null
                }
            }))
        };
        
        const blob = new Blob([JSON.stringify(geoJson, null, 2)], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `lavmis_properties_${new Date().toISOString().slice(0,10)}.geojson`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        logger.addLogEntry("Property data exported to GeoJSON", "success");
    }

    // ==============================================
    // FIREBASE FUNCTIONS
    // ==============================================
    async function backupToFirebase() {
        if (!firebaseDataManager) {
            alert('Firebase not initialized. Please log in again.');
            return;
        }
        
        const backupBtn = document.querySelector('button[onclick="backupToFirebase()"]');
        const originalText = backupBtn.innerHTML;
        
        try {
            backupBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Backing up to Firebase...';
            backupBtn.disabled = true;
            
            const result = await firebaseDataManager.backupAllToFirebase();
            
            alert(` Backup successful!\n\nBackup ID: ${result.backupId}\nRecords backed up: ${result.recordCount}\nSynced records: ${result.syncedCount}\n\nYour data is now safely stored in Firebase Cloud.`);
            
            logger.addLogEntry(`Full backup to Firebase completed: ${result.recordCount} records`, "success");
            
        } catch (error) {
            console.error('Firebase backup error:', error);
            alert(` Backup failed: ${error.message}\n\nPlease check your internet connection and try again.`);
            
            logger.addLogEntry(`Firebase backup failed: ${error.message}`, "error");
        } finally {
            backupBtn.innerHTML = originalText;
            backupBtn.disabled = false;
            hideModal();
        }
    }
    
    async function restoreFromFirebase() {
        if (!firebaseDataManager) {
            alert('Firebase not initialized. Please log in again.');
            return;
        }
        
        try {
            const result = await firebaseDataManager.restoreFromFirebase();
            hideModal();
        } catch (error) {
            console.error('Firebase restore error:', error);
            alert(`Restore failed: ${error.message}`);
        }
    }
    
    async function syncAllToFirebase() {
        if (!firebaseDataManager) {
            alert('Firebase not initialized. Please log in again.');
            return;
        }
        
        try {
            await firebaseDataManager.syncAllToFirebase();
        } catch (error) {
            console.error('Firebase sync error:', error);
            alert(`Sync failed: ${error.message}`);
        }
    }

    // ==============================================
    // MODAL FUNCTIONS
    // ==============================================
    function showBackupModal() {
        document.getElementById('backupModal').style.display = 'flex';
    }
    
    function showRestoreModal() {
        document.getElementById('restoreModal').style.display = 'flex';
    }
    
    function hideModal() {
        document.getElementById('backupModal').style.display = 'none';
        document.getElementById('restoreModal').style.display = 'none';
        document.getElementById('restoreFile').value = '';
    }
    
    function backupData(format) {
        if (storageManager) {
            storageManager.backupData(format);
        }
    }
    
    function restoreData() {
        const fileInput = document.getElementById('restoreFile');
        if (fileInput.files.length === 0) {
            alert("Please select a backup file first.");
            return;
        }
        
        if (confirm("This will replace ALL current property data. Are you sure?")) {
            if (storageManager) {
                storageManager.restoreData(fileInput.files[0]);
            }
            hideModal();
        }
    }
    
    function clearAllData() {
        if (storageManager) {
            storageManager.clearAllData();
        }
    }
    
    function clearLog() {
        if (logger) {
            logger.clearLog();
        }
    }

    // ==============================================
    // EXPORT FUNCTIONS FOR HTML ONCLICK
    // ==============================================
    
    // Login function
    function attemptLogin() {
        if (loginSystem) {
            loginSystem.attemptFirebaseLogin();
        }
    }
    
    // Logout functions
    function initiateLogout() {
        if (loginSystem) {
            loginSystem.initiateLogout();
        }
    }
    
    function cancelBackup() {
        if (loginSystem) {
            loginSystem.cancelBackup();
        }
    }
    
    function finishLogout() {
        if (loginSystem) {
            loginSystem.finishLogout();
        }
    }

    // ==============================================
    // NETWORK STATUS
    // ==============================================
    function toggleNet(online) {
        const lbl = document.getElementById('net-label');
        lbl.innerText = online ? "ONLINE" : "OFFLINE";
        lbl.className = online ? "indicator on" : "indicator off";
    }
    
    // Network Awareness
    window.addEventListener('online', () => {
        toggleNet(true);
        if (logger) {
            logger.addLogEntry("Network connection restored", "success");
        }
    });
    
    window.addEventListener('offline', () => {
        toggleNet(false);
        if (logger) {
            logger.addLogEntry("Working offline", "warning");
        }
    });

    // ==============================================
    // INITIALIZE ON PAGE LOAD
    // ==============================================
    window.onload = () => {
        // Initialize login system
        loginSystem = new LoginSystem();
        
        // Set initial network status
        toggleNet(navigator.onLine);
    };
</script>

</body>
</html>
